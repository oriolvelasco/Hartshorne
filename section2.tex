\section{Schemes}

\begin{ex}
	Let $A$ be a ring, let $X = \Spec A$, let $f \in A$ and let $D(f) \subseteq X$ be the open complement of $V((f))$. Show that the locally ringed space $(D(f), \locO_X|_{D(f)})$ is isomorphic to $\Spec A_f$.
\end{ex}

\begin{sol}
	We have to build an isomorphism of locally ringed spaces between $\Spec(A_f)$ and $(D(f), \locO_X|_{D(f)})$. Let $S = \{f^n\}_{n \geq 0}$, so $A_f = S^{-1}A$. Then, we know that there is a bijective correspondence between prime ideals of $A_f$ and prime ideals of $A$ that don't cut $S$, which in this case is equivalent to ideals of $A$ that don't contain $f$ (as $f^n \in \ip \iff f \in \ip$) (Atiyah-MacDonald, Proposition 3.11).

	We have a morphism of rings $\varphi: A \to A_{f}$ that maps $a \mapsto a/1$. It induces an application $f: \Spec (A_f) \to D(f)$, $f(\ip) =  \varphi^{-1}(\ip)$ which is bijective and whose inverse is $f^{-1}: D(f) \to \Spec(A_f)$, and $f^{-1}(\ip) = S^{-1}\ip$. $f$ is continuous (as it was seen at Proposition 2.3). As every ideal in $A_f$ is of the form $S^{-1}\ia$ for a certain $\ia$ ideal of $A$ (also a result in Proposition 3.11 of Atiyah-MacDonald), then the closed sets of $\Spec(A_f)$ are of the form $V(S^{-1}\ia) = \{S^{-1}\ip, \text{ with } \ip \text{ prime ideals of A such that} f \notin \ip, \, \ip \supseteq \ia\}$. Then $(f^{-1})^{-1}(V(S^{-1}\ia)) = V(\ia) \cap D(f)$, which is a closed subset of $D(f)$. In conclusion, $f^{-1}$ is also continuous and so $f$ is an homeomorphism.

	Now we need to build an isomorphism of sheaves $f^{\#}: \locO_X|_{D(f)} \to f_* \locO_{Spec(A_f)}$. Let $f^{\#}(V): \locO_X|_{D(f)}(V) \to f_* \locO_{Spec(A_f)}(V)$ map the section $\locO_X|_{D(f)}(V) \ni s : V \to \bigcup_{\ip \in V} A_\ip$ to the section $s': \locO_{\Spec{A_f}}(f^{-1}(V))$ that maps a prime ideal $S^{-1}\ip$ to $s'(S^{-1}\ip) = \frac{a/1}{g/1} \in (S^{-1}A)_{S^{-1}\ip}$ if $s(\ip) = a/g \in A_{\ip}$. To check that this is an isomorphism it's enough to check that the induced application on stalks is an isomorphism (By Exercise 1.2). But we already know by Proposition 2.2 that the stalk at point $\ip$ of $\locO_{\Spec(A)}$ is $A_{\ip}$ and the stalk at point $S^{-1}\ip$ of $\locO_{\Spec(A_f)}$ is $(S^{-1}A)_{S^{-1}\ip}$. 

	Then, it is enough to check that $\phi: A_{\ip} \to (S^{-1}A)_{S^{-1}\ip}$ such that $\phi(\frac{a}{g}) = \frac{a/1}{g/1}$ is an isomorphism of rings.
	\begin{itemize}
		\item \textbf{Surjectivity:} Let $\frac{a/f^n}{g/f^m} \in (S^{-1}A)_{S^{-1}\ip}$. Then if $n \geq m$ we have that 
		\[
			\phi \left (\frac{a}{gf^{n-m}} \right ) = \frac{a/1}{gf^(n-m)/1} = \frac{af^n/f^n}{gf^n/f^m} = \frac{a/f^n}{g/f^m} 
		\]
		because $(af^n/f^n) (g/f^m) - (a/f^n) (gf^n/f^m) = 0$.

		Similarly, if $m \geq n$ and then 
		\[
			\phi \left (\frac{a f^{m-n}}{g} \right ) = \frac{af^{m-n}/1}{g/1} = \frac{af^m/f^n}{gf^m/f^m} = \frac{a/f^n}{g/f^m} 
		\]
		because $(af^m/f^n) (g/f^m) - (a/f^n) (gf^m/f^m) = 0$.

		\item \textbf{Injectivity:} $\frac{a/1}{g/1} = 0 \iff \exists h/f^k \in S^{-1}A$ such that $(h/f^k)(a/1) = 0 \iff ha = 0 \iff \frac{a}{g} = 0$ 
	\end{itemize}

	So we have only left to check that we have indeed a local homeomorphism. Again, it will be enough to check that $\phi^{-1}(V)(S^{-1}\ip (S^{-1}A)_{S^{-1}\ip}) = \ip A_{\ip}$. But this is clear as $\frac{a/1}{g/1} \in S^{-1}(\ip)(S^{-1}(A))_{S^{-1}\ip} \iff a/1 \in S^{-1}\ip \iff a \in \ip \iff a/g \in \ip A_{\ip}$. With all these results we have finally that $(D(f), \locO_X|_{D(f)}) \cong \Spec(A_f)$
\end{sol}

\begin{ex}
	Let $(X, \locO_X)$ be a scheme, and let $U \subseteq X$ be any open subset. Show that $(U, \locO_X|_U)$ is a scheme. We call this the induced scheme structure on the open set $U$, and we refer to $(U, \locO_X|_U)$ as an open subscheme of $X$.
\end{ex}

\begin{sol}
	\textbf{Observation:} Let's observe that if we have an isomorphism of ringed spaces, the restriction to open sets is still an isomorphism. That is, if $(X, \locO_X) \cong (Y, \locO_Y)$ via the isomorphism of locally ringed spaces $(f, f^{\#})$, then given $U$ any open set of $X$, $(U, \locO_X|_U) \cong (f(U), \locO_Y|_{f(U)})$. It is clear that the restriction of the homeomorphism $f$ to $U$, $f|_U: U \to f(U)$ is still an homeomorphism. In addition, the stalks at $P \in U$ are still the same, and so are the induced morphisms on stalks $f^{\#}_P$, so they're local isomorphisms and therefore the morphism of sheaves $f^{\#}|_U$ is an is a local isomorphism, and so we have indeed that $(U, \locO_X|_U) \cong (U, \locO_Y|_{f(U)})$.

	Let $P \in U$. As $(X, \locO_X)$ is a scheme, then $\exists V$ an open neighbourhood of $P$ such that $(V,\locO_X|_V) \cong (\Spec (A), \locO_{\Spec(A)})$ for a certain ring $A$. Let $(f, f^{\#})$ denote this isomorphism of locally ringed spaces. As $U \cap V$ is an open set of $V$, then $f(U \cap V)$ is an open set of $\Spec(A)$, so $f(U \cap V) = \bigcup_{i \in I} D(f_i)$, so in particular $f(P) \in D(f_i)$ for a certain $i$. Then, $P \in f^{-1}(D(f)) \subseteq V \cap U \subset U$, so taking into account the observation we have that $(f^{-1}(D(f)), \locO_X|_{f^{-1}(D(f))}) \cong (D(f), \locO_{\Spec(A)}|_{D(f)})$. Finally, using Exercise 2.1 we have the isomorphism $(D(f), \locO_{\Spec(A)}|_{D(f)}) \cong \Spec(A_f)$. So in conclusion for each $P \in U$ there is an open neighbourhood of $P$ ($U \cap V$) which is isomorphic as a locally ringed space to the spectrum of a ring ($A_f$), that is, $(U, \locO_X|_U)$ is a scheme.
\end{sol}

\begin{ex}
	Reduced Schemes. A scheme $(X, \locO_X)$ is reduced if for every open set $U \subseteq X$ the ring $\locO_X(U)$ has no niloptent elements.
	\begin{enumerate}[label=\alph*)]
		\item Show that $(X, \locO_X)$ is reduced if and only if for every $P \in X$ the local ring $\locO_{X,P}$ has no nilpotent elements.
		\item Let $(X, \locO_X)$ be a scheme. Let $(\locO_X)_{red}$ be the sheaf associated to the presheaf $U \mapsto \locO_X(U)_{red}$ where for any ring $A$, we denote $A_{red}$ the quotient of $A$ by its ideal of nilpotent elements. Show that $(X, (\locO_X)_{red})$ is a scheme. We call it the reduced scheme associated to $X$ and we denote it by $X_{red}$. Show that there is a morphism of schemes $X_{red} \to X$ which is an homeomorphism on the underlying topological spaces. 
		\item Let $f: X \to Y$ be a morphism of schemes, and assume that $X$ is reduced. Show that there is a unique morphism $g: X \to Y_{red}$ such that $f$ is obtained by composing $g$ with the natural map $Y_{red} \to Y$.
	\end{enumerate}
\end{ex}

\begin{sol}
	\begin{enumerate}[label=\alph*)]
		\item $\boxed{\Rightarrow}$ Suppose that $0 \neq \overline{(U,f)} \in \locO_{X,P}$ is a nilpotent element. This implies that $\exists n$ such that $\overline({U, f^n}) = \overline{(U,f)}^n = 0$, that is, $\exists W \subseteq U$ such that $f^n|_{W} = 0$ But restriction morphisms are ring morphisms so $(f|_{W})^n = 0$. Moreover, $f|_W$ is not zero, because that would imply that $\overline{(U,f)} = 0$. So in conclusion $f|_W \in \locO_X(W)$ is nilpotent which is a contradiction.

		\boxed{\Leftarrow} Now suppose that $\locO_X(U)$ has niloptent elements for a certain $U$. That means that $\exists f \neq 0 \in \locO_X(U), \, \exists n \geq 1$ such that $f^n = 0$. Now $\exists P \in U$ such that $\overline{(U,f)} \in \locO_{X,P}$ is not zero, as otherwise we would have an open covering of $U$, $\{W_Q\}_{Q \in U}$ such that $f|_{W_Q} = 0$, which would imply $f = 0$. Then, we have $0 \neq \overline{(U,f)}$, but $0 = \overline{(U, f^n)} = \overline{(U,f)}^n$, so $\locO_{X,P}$ has nilpotent elements, which is a contradiction.

		\item First let's make some observations that will be useful later. 

		\textbf{Obs 1:} Given a morphism of rings $\varphi: A \to B$, it induces a morphism between the reduced rings $\varphi_{red}:A_{red} \to B_{red}$, defined by $\varphi_{red}(\overline{a}) = \overline{\varphi(a)}$. The application is well defined, as the image of a nilpotent element is also nilpotent (let $f \neq 0, n \geq 0$ such that $f^n = 0$; then $(\varphi(f))^n = \varphi(f^n) = 0$). Moreover if $\varphi$ is injective $\varphi_{red}$ is also injective: Indeed, $\varphi_{red}(\overline{f}) = 0 \imp \overline{\varphi(f)} = 0 \imp \exists n$ such that $\varphi(f^n) = (\varphi(f))^n = 0$, and, by injectivity of $\varphi$, $f^n = 0 \imp \overline{f} = 0$. Finally, if $\varphi$ is surjective, $\varphi_{red}$ is also surjective: Given any $\overline{b} \in B_{red}$, $\exists a \in A$ such that $\varphi(a) = b$ so $\varphi_{red}(\overline{a}) = \overline{b}$.

		\textbf{Obs 2:} We will prove that $((\locO_{X})_{red})_P = (\locO_{X,P})_{red}$. Indeed, both sets are pairs of elements $(U,f)$ under a certain equivalence relation. Two pairs $(U,f)$ and $(V,g)$ are equal on $((\locO_{X})_{red})_P$ if and only if $\exists W \subseteq U \cap V$ such that $\overline{f}|_W = \overline{g}|_W \iff \overline{f|_W} = \overline{g|_W} \iff f|_W = g|_W + r$ with $r$ a nilpotent element of $\locO_X(W)$. Replacing $W$ by a smaller neighbourhood if necessary, this happens if and only if the element $(W,r) \in \locO_{X,P}$ is nilpotent, so if and only if the elements $(U,f)$ and $(V,g)$ are related in $(\locO_{X,P})_{red}$.

		\textbf{Obs 3:} Let's prove that $(\Spec(A), (\locO_{\Spec(A)})_{red}) \cong (\Spec(A_{red}), \locO_{\Spec(A_{red})})$. First note that the natural application $A \to A_{red}$ induces an application $f: \Spec(A_{red}) \to \Spec(A)$, which is an homeomorphism (Atiyah-Macdonald, Exercise 1.21 iv.). Now for each open set $U$, $(\locO_{\Spec(A)}(U))_{red}$ is the ring consisting on the applications $s: U \to \bigcup_{\ip \in U} A_{\ip}$ such that $\exists U' \subseteq U$ and $a,f \in A$, $f \notin \iq, \, \, \forall \iq \in U'$ such that $s(\iq) = a/f \in \iq$, for every $\iq \in U'$, module the equivalence relation that two applications are equal if their difference is a nilpotent application (the image of each $\ip$ is nilpotent in $A_{\ip}$). Then $(\locO_{\Spec(A)})_{red}(U)$ is the ring of applications $\phi: U \to \bigcup_{P \in U} ((\locO_{\Spec(A)})_{red})_P$ such that $\forall P \in U$ exists $U' \subseteq U$ neighbourhood of $P$ and $s \in \locO_{\Spec(A)}(U')_{red}$ such that $\forall \iq \in U' \phi(\iq) = s_{\iq}$. Now by Observation 2 we can identify the stalk $((\locO_{\Spec(A)})_{red})_P$ with $(A_{\ip})_{red}$. Therefore, this induces a morphism of sheaves $f^{\#}: (\locO_{\Spec(A)})_{red} \to \locO_{\Spec(A_{red})}$ by the natural local isomorphism $(A_{\ip})_{red} \cong (A_{red})_{\overline{\ip}}$. As these are the stalks and they're isomorphic, then $(f,f^{\#})$ is in fact an isomorphism of locally ringed spaces, so in conclusion 
		\[
			(\Spec(A), (\locO_{\Spec(A)})_{red}) \cong (\Spec(A_{red}), \locO_{\Spec(A_{red})})
		\]

		Now let's proceed to prove that $(X,(\locO_X)_{red})$ is a scheme. Let $P \in X$. As $(X, \locO_X)$ is a scheme, then $\exists V$ a neighbourhood of $P$ such that $(V, \locO_X|_{V}) \cong (\Spec(A), \locO_{\Spec(A)})$, so we have an isomorphism of locally ringed spaces $f: \Spec(A) \to V$, $f^{\#}: \locO_X|_V \to f_* \locO_{\Spec(A)}$. As a morphism of sheaves, $f^{\#}$ induces a morphism of rings on every open set: $f^{\#}(W): \locO_X|_V (W) \to f_* \locO_{Spec(A)}(W)$. By Obs 1, we can induce morphisms $f^{\#}(W)_{red}: \locO_X|_V (W)_{red} \to f_* \locO_{\Spec(A)}(W)_{red}$, which are injective by Observation 1. In turn, this induces a morphism on the associated sheaves: $f^{\#}_{red}: (\locO_X|_V)_{red} \to (f_* \locO_{Spec(A)})_{red}$, which is injective by Exercise 1.4a. Let's check that it is also surjective. Indeed, given $\overline{x} \in f_* \locO_{\Spec(A)}(W)$ we know that $\exists \{W_i\}$ open cover of $W$, and $x_i \in \locO_X|_V (W)$ such that $f^{\#}(W_i)(x_i) = x|_{W_i}$. Then, again using observation 1, $f^{\#}_{red}(W_i)(\overline{x_i}) = \overline{x|_{W_i}} = \overline{x}|_{W_i}$, and so $f^{\#}_{red}$ is surjective. Moreover, using observation 2, the induced applications on stalks are in fact the reductions of the applications on stalks, that is $(f^{\#}_{red})_P = (f^{\#}_P)_{red}$ so they're local morphisms because $f^{\#}_P$ are local morphisms and the reduction preserves the correspondence between ideals. Finally let's observe that $(f_* \locO_{\Spec(A)})_{red} = f_*(\locO_{\Spec(A)})_{red}$ and $(\locO_X|_V)_{red} = (\locO_X)_{red}|_{V}$, (it's just a matter of checking that the corresponding rings on any open set are equal). So we have proven that we have a morphism of sheaves $(V,(\locO_X)_{red}|_V) \cong (\Spec(A), (\locO_{\Spec(A)})_{red})$ and using observation 3 and composing morphisms, we have finally 
		\[
			(V,(\locO_X)_{red}|_V) \cong (\Spec(A_{red}), \locO_{\Spec(A_{red})})
		\]

		Indeed, we have proven that every point $P$ has an open neighbourhood that is isomorphic to the spectrum of a certain ring, i.e. $(X, (\locO_X)_{red})$ is a scheme.

		Now let's build a morphim of schemes between $X_{red}$ and $X$. That is, let $f: X \to X$ be the identity application, which is an homeomorphism. Now let $f^{\#}(U): \locO_X(U) \to (\locO_X)_{red}(U)$ be the application that maps $x \in \locO_X(U)$ to the constant application $s: U \to ((\locO_X)_{red})_P$, $s(P) = \overline{x}_P$, where $\overline{x}$ is the image of $x$ in $(\locO_X(U))_{red}$. This induces a morphism of sheaves $f^{\#}: \locO_X \to (\locO_X)_{red}$, with induced applications on stalks $f^{\#}_P: (\locO_X)_P \to ((\locO_X)_{red})_P$. $f^{\#}_P$ maps an element to its reduction modulo the nilpotent element of the stalk (we are using the definition of the morphism $f^{\#}$ and observation 2 to identify $((\locO_X)_{red})_P$ and $(\locO_{X,P})_{red}$), and therefore its a local morphism of rings. Then $(f,f^{\#})$ is a morphism of locally ringed spaces, with $f$ homeomorphism, as desired.

		\item A morphism of sheaves $f^{\#}: \locO_Y \to f_* \locO_X$ induces (by Observation 1) for each open set $U \subseteq Y$, a morphism $\locO_Y(U)_{red} \to f_* \locO_X(U)_{red} = f_* \locO_X(U)$ where the last equality is because $X$ is reduced. This defines a morphism of presheaves between the presheaf  $U \mapsto \locO_Y(U)_{red}$ and the sheaf $f_* \locO_X$.
		Then by Proposition 1.2 there exists a unique morphism of sheaves $g^{\#}: \locO_{Y_{red}} \to f_*\locO_X$ such that the composition with the sheaffification application $\theta$ is the morphism of presheaves that we have induced from $f^{\#}$. Now let $g = f: \mathrm{sp}(X) \to \mathrm{sp}(Y) = \mathrm{sp}(Y_{red})$, and then $(g, g^{\#})$ is a morphism of ringed spaces between $X$ and $Y_{red}$. To prove that it is a morphism of schemes we have to prove that the applications on stalks are local morphisms. But we know from observation 2 that $\locO_{Y_{red}, f(P)} = (\locO_{Y,f(P)})_{red}$. The applications on stalks $g^{\#}_P$ are in fact the applications induced on the reduced rings (Observation 1) by the applications $f^{\#}_P$. $(\locO_{Y,f(P)})_{red} \to (\locO_{X,P})_{red}$. Every prime ideal contains the nilpotent elements, and so the maximal ideals of the rings $\locO_{Y,f(P)}$ and $\locO_{X,P}$ contain the nilradicals. Then, by the correspondence between ideals of a ring and ideals of the reduced ring that contain the nilradical, the antiimage of the class of the maximal ideal of $\locO_{X,P}$ is the maximal ideal of $(\locO_{Y,f(P)})_{red}$, and so $g^{\#}_P$ are indeed local.

		Moreover, $g$ satisfies that its composition with the natural application $\pi: Y_{red} \to Y$ is $f$. It is clear that this happens on the underlying topological spaces, because $g = f$ and the application $\mathrm{sp}(Y_red) \to \mathrm{sp}(Y)$ is the identity (moreover this shows that $g = f$ on the underlying topological spaces is the only possibility). To prove that the morphisms of sheaves are equal it will be enough to prove that the morphisms on stalks are equal. $g^{\#}_P \circ \pi^{\#}_P: \locO_{Y,f(P)} \to \locO_{Y_{red}, f(P)} = (\locO_{Y,f(P)})_{red} \to \locO_{X,P}$. Any morphism of rings has to send nilpotent elements to nilpotent elements, and, as $X$ is reduced, the image on any nimpotent element is zero. Thus, the application $f^{\#}_P$ is totally determined by the reduced application. This proves that $g^{\#}_P \circ \pi^{\#}_P = f_P^{\#}$ and that $g^{\#}_P$ is unique with this property.  
	\end{enumerate}
\end{sol}

\begin{ex}
	Let $A$ be a ring and let $(X, \locO_X)$ be a scheme. Given a morphism $F: X \to \Spec(A)$, we have an associated map on sheaves $f^{\#}: \locO_{\Spec(A)} \to f_* \locO_X$. Taking global sections we obtain a homomorphism $A \to \Gamma(X,\locO_X)$. Thus there is a natural map
	\[
		\alpha: \Hom_{\mathfrak{Sch}}(X, \Spec(A)) \to \Hom_{\mathfrak{Rings}}(A,\Gamma(X, \locO_X))
	\]
	Show that $\alpha$ is bijective (cf. (I, 3.5) for an analogous statement about varieties).
\end{ex}

\begin{sol}
	We will define an map $\beta: \Hom_{\mathfrak{Rings}}(A,\Gamma(X, \locO_X)) \to \Hom_{\mathfrak{Sch}}(X, \Spec(A))$. Given $\varphi: A \to \Gamma(X, \locO_X)$ morphism of rings, composing with the maps $\pi_P: \Gamma(X,\locO_X) \to \locO_{X,P}$, $x \mapsto \overline{(X,x)}$ we obtain morphisms of rings $\varphi_P: A \to \locO_{X,P}$ for each $P \in X$.

	As $(X, \locO_X)$ is a scheme, then it is in particular a locally ringed space, so $\locO_{X,P}$ is a local ring for all $P$. Let $\im_P$ be the maximal ideal of $\locO_{X,P}$. Then, we can define an application $f: X \to \Spec(A)$ as $f(P) = \varphi_P^{-1}(\im_P)$. The application is clearly well defined, as the antiimage of a prime ideal is prime. Now we will check that it is a continuous application. It is enough to prove that the antiimage of a basic open subset is open. So let $h \in A, D(h)$ the set of prime ideals of $A$ that don't contain $h$. Then, $f^{-1}(D(h)) = \{P \in X \text{ such that } h \notin \varphi_P^{-1}(\im_P)\}$. But $h \notin \varphi_P^{-1}(\im_P) \iff \varphi_P(h) \notin \im_P \iff \overline{(X,\varphi(h))}$ is a unit in $\locO_{X,P}$ $\iff \exists U_P$ neighbourhood of $P$ and $k \in \Gamma(U_P, \locO_X)$ such that $\varphi(h)|_{U_P} k = 1$. Then, $\varphi(h)_Q \in \locO_{X,Q}$ is a unit $\forall Q \in U_P \imp h \notin \varphi_Q(\im_Q) \, \, \forall Q \in U_P$. That means that $f^{-1}(D(h)) = \bigcup_{P \in f^{-1}(D(h))} U_P$ is an open set, and therefore $f$ is continuous.

	Note that the applications $\varphi_P$ can induce naturally applications $\varphi'_P: A_{\varphi^{-1}_P(\im_P)} \to \locO_{X,P}$ mapping $\frac{a_1}{a_2} \mapsto \frac{\varphi_P(a_1)}{\varphi_P(a_2)}$. These are well defined local ring morphisms. Now let's define a morphism of sheaves $f^{\#}$ between $\locO_{\Spec(A)}$ and $f_*\locO_X$ as follows: Given $s \in \locO_{\Spec(A)}(U)$, $s: U \to \bigcup_{\ip \in U} A_{\ip}$, the composition $\varphi_P' \circ s \circ f: f^{-1}(U) \to \bigcup_{P \in f^{-1}(U)} \locO_{X,P}$ is an element of $\Gamma(f^{-1}(U),\locO_X)$. Moreover, the induced morphisms on stalks are just the applications $\varphi_P'$, which we already know that are local morphisms. In conclusion, we have defined a morphism of schemes 
	\[
		\beta(\varphi) = (f, f^{\#}): (X,\locO_X) \to (\Spec(A), \locO_{\Spec(A)})
	\]

	Now let $(f, f^{\#}):= \beta(\varphi)$. Taking global sections of $f^{\#}$ we obtain a map $\psi: \Gamma(\Spec(A), \locO_{\Spec(A)}) \to \Gamma(X, \locO_X)$. As we saw on Proposition 2.2, $\Gamma(\Spec(A), \locO_{\Spec(A)})$ is isomorphic to $A$ via the map $A \ni a \mapsto s: \Spec(A) \to \bigcup_{\ip \in \Spec{A}} A_{\ip}, s(\ip) = \frac{a}{1}$. So given an element of $A$, $f^{\#}(\Spec(A))(a)$ is the application $s: X \to \bigcup_{P \in X} \locO_{X,P}$ that maps each $P$ to $\overline{(X, \varphi(a))} \in \locO_{X,P}$, which can be identified with the element $\varphi(a) \in \Gamma(X, \locO_X)$. This proves that $\alpha(\beta(\varphi)) = \varphi$, so the application $\alpha$ is surjective.

	Reciprocally, let $\varphi:= \alpha((f, f^{\#}))$ a morphism of rings between $A$ and $\Gamma(X, \locO_X)$, that is, $\alpha = f^{\#}(\Spec(A))$. The morphism of schemes $f^{\#}$ induces morphisms on stalks: $f^{\#}_P: (\locO_{\Spec(A)})_{f(p)} \to \locO_{X,P}$ given by $\overline{(U,x)} \mapsto \overline{(f^{-1}(U), f^{\#}(U)(x))}$. Composing with the morphism $i_P: A \mapsto (\locO_{\Spec(A)})_{f(P)}$, $i(a) = \overline{(\Spec(A), a)}$ we obtain a morphism $f^{\#}_P \circ i: A \to \locO_{X,P}$ mapping $a \mapsto \overline{(X, \varphi(a))}$. On the other hand, we have already seen that there are morphisms $A \to \locO_{X,P}$ induced by $\varphi$, that we have named $\varphi_P = \pi_P \circ \varphi$, that are equal to $f^{\#}_P \circ i$. Therefore, we have the following commutative diagram
	\begin{tikzcd}
		A \arrow[r, "i"] \arrow[d, "\varphi"]
		& A_{f(P)} \arrow[d, "f^{\#}_P"] \\
		\Gamma(X, \locO_X) \arrow[r, "\pi_P"]
		& \locO_{X,P}
	\end{tikzcd}

	In particular, the antiimage of the maximal ideal $\im_P$ by the two paths must be equal, so $f(p) = (f^{\#}_P \circ i)^{-1}(\im_P) = (\pi_P \circ \varphi)^{-1} = \varphi_P^{-1}(\im_P)$. This means that the application between topological spaces $\beta(\varphi)$ is the same as the original application $f$. Moreover, it is also a consequence of the commutative diagram that the morphisms induced by $\beta$ on stalks are the same as the originals, that is, $\beta(\varphi)^{\#}_P = f^{\#}_P$. Then, given an open set $U \subseteq \Spec(A)$, $x \in \Gamma(U, \locO_{\Spec(A)})$ we have that $\beta(\varphi)^{\#}(U)(x)_P = f^{\#}(U)(x)_P$ for every $P \in U$. Then, $\beta(\varphi)^{\#}(U)(x)$ and $f^{\#}(U)(x)$ agree when restricted to an open neighbourhood $W_P$ of $P$. These open neighbourhoods $\{W_P\}$ form an open cover of $U$, and by Property 3 of sheaves we have the equality in $U$. In conclusion, we have proven that $\beta(\alpha(f,f^{\#})) = (f,f^{\#})$, so $\alpha$ is injective. This completes the proof, and so we have a bijective correspondence 
	\[
		\alpha: \Hom_{\mathfrak{Sch}}(X, \Spec(A)) \to \Hom_{\mathfrak{Rings}}(A,\Gamma(X, \locO_X))
	\]
\end{sol}

\begin{ex}
	Describe $\Spec(\Z)$ and show that it is a final object for the category of schemes, i.e., each scheme $X$ admits a unique morphism to $\Spec(\Z)$.
\end{ex}

\begin{sol}
	The prime ideals of $\Z$ are $\ip = (p)$ with $p$ a prime integer, and $(0)$. All the primes of the first type are maximal ideals, so they're closed points in the ring spectrum. Moreover, every ideal contains the zero ideal, so $(0)$ is a generic point in the ring spectrum, such that its closure is the whole space.

	Given any commutative ring with unity $A$, there exists a unique morphism of rings $\varphi: \Z \to A$, defined by $\varphi(n) = n 1_{A}$. In particular, given a scheme $(X, \locO_X)$, we take $A = \Gamma(X,\locO_X)$, and it exists a unique ring morphism $\Z \to \Gamma(X, \locO_X)$. So, by the bijective correspondence between ring morphisms $B \to \Gamma(X, \locO_X)$ and morphisms of schemes $X \to \Spec(B)$ proven in Exercise 2.4, there exists a unique morphism of schemes $X \to \Spec(\Z)$, so $\Spec(\Z)$ is a final object in the category of schemes.
\end{sol}

\begin{ex}
	Describe the spectrum of the zero ring, and show that it is an initial object for the category of schemes. 
\end{ex}

\begin{sol}
	The zero ring $R = 0$, has only one element, so the only ideal of $R$ is the whole ring and therefore it has no prime ideals. Therefore, $\Spec(R) = \varnothing$, the spectrum of the zero ring is the empty set. 

	Now, given any scheme $(X,\locO_X)$ there is a unique application $\varnothing: \Spec(R) \to X$, which is the empty function, and it is continuous (the antiimage of every set is the empty set which is open). Moreover, the only open set in $\Spec(R)$ is the empty set $U = \varnothing$ so by definition of sheaf $\locO_{\Spec(R)}(U) = 0$ and so for each $U \subseteq X$ we have a unique application $\locO_X(U) \to \locO_{\Spec(R)}(f^{-1}(U)) = 0$ which is the zero application (maps every element to zero). In conclusion, we have proven that there is a unique morphism of schemes $\Spec(R) \to X$, so $\Spec(R)$ is an initial object for the category of schemes.
\end{sol}

\begin{ex}
	Let $X$ be a scheme. For any $x \in X$, let $\locO_X$ be the local ring at $x$ and $\im_x$ its maximal ideal. We define the residual field of $x$ on $X$ to be the field $k(x) = \locO_X/\im_x$. Now let $K$ be any field. Show that to give a morphism of $\Spec (K)$ to $X$ is it equivalent to give a point $x \in X$ and an inclusion map $k(x) \to K$.
\end{ex}

\begin{sol}
	Let $P \in \Spec (K)$ be the only point of this topological space. Given a morphism of schemes, $(f,f^{\#}): (\Spec (K), \locO_{\Spec(K)}) \to (X, \locO_X)$, $f$ is completely determined by a point $x \in X$, the image of the only point $P \in \Spec(K)$. In addition, $f^{\#}$ induces a morphism on the stalks $f^{\#}_P: \locO_{X,x} \to K$. It is a local morphism because $(f,f^{\#})$ is a morphism of locally ringed spaces, and so $\ker(f^{\#}_P) = (f^{\#}_P)^{-1}(0) = \im_x$ and therefore we can induce an injective morphism $k(x) = \locO_{X,x}/\im_x \to k$. Reciprocally, given an injection $k(x) \to K$ we can induce a unique local morphism $\locO_{X,x} \to K$ sending an element to its class in $k(x)$ and then applying $\varphi$. We will see now that any morphism $f^{\#}$ on the structure sheafs it totally determined by the induced application on the stalk at $P$. 

	%Reciprocally, given $x \in X$ and $\varphi: k(x) \to k$ injective morphism, this defines a unique morphism of schemes. The application between topological spaces $g: \Spec(K) \to X$ is defined by $g(P) = x$ and it is clearly continuous as $g^{-1}(U) = \varnothing$ if $x \notin U$ or $P$ if $x \in U$, which are both open sets. Moreover, $\varphi$ induces an application $\varphi': \locO_{X,x} \to K$ sending an element to its class in $k(x)$ and the applying $\varphi$. Now let's define a morphism between the structure sheaves. Given an open set $U \subseteq X$, if $x \notin U$ then $g^{-1}(U) = \varnothing$, so the only possible application $\locO_X(U) \to \locO_{\Spec(K)}(f^{-1}(U))$ is the zero application. On the other side, if $x \in U$, we can define an $g^{\#}(U)$ that takes an application $s: U \to \bigcup_{Q \in U}\locO_{X,Q}$ and sends it to $\varphi'(s(x)) \in K = \locO_{\Spec(K)}(f^{-1}(U))$. 

	Indeed, given an open set $U \subseteq X$, if $x \notin U$ then $f^{-1}(U) = \varnothing$, so the only possible application $\locO_X(U) \to \locO_{\Spec(K)}(f^{-1}(U))$ is the zero application. Now let's observe that if $x \in U,V$ and $V \subseteq U$, then the restriction morphisms from $f^{-1}(U)$ to $f^{-1}(V)$ is the identity, and therefore $f^{\#}(U)(s) = f^{\#}(U)(s)|_{f^{-1}(V)} = f^{\#}(V)(s|_V)$. Than means that two elements $s,t \in \locO_X(U)$ have the same image by $f^{\#}(U)$ if and only if they're equal in a neighbourhood of $x$. In conclusion, the image of an element $s$ by $f^{\#}(U)$ is equal to the image of its stalk at $x$ by the application $f^{\#}_P$. 

	In conclusion, a morphism of schemes $(f,f^{\#}): (\Spec (K), \locO_{\Spec(K)}) \to (X, \locO_X)$ is completely determined by a point $x \in X$ and an injection $k(x) \to K$.
\end{sol}

\begin{ex}
	Let $X$ be a scheme. For any point $x \in X$ we define the Zariski tangent space $T_X$ to $X$ at $x$ to be the dual space of the $k(x)$-vector space $\im_x/\im_x^2$. Now assume that $X$ is a scheme over a field $k$, and let $k[\epsilon]/\epsilon^2$ be the ring of dual numbers over $k$. Show that to give a $k$-morphism of $\Spec k[\epsilon]/\epsilon^2$ to $X$ is equivalent to giving a point $x \in X$ rational over k (i.e., such that $k(x) = k$), and an element of $T_x$.
\end{ex}

\begin{ex}
	If $X$ is a topological space, and $Z$ an irreducible closed subset of $X$, a generic point for $Z$ is a point $\zeta$ such that $Z = \overline{\{\zeta\}}$. If $X$ is a scheme, show that every (nonempty) closed subset has a unique generic point.
\end{ex}

\begin{sol}
	Foreach $P \in Z$, let's consider $V_P$ the open neighbourhood of $P$ such that $(V_P, \locO_X|_{V_P})$ is isomorphic to the spectrum of a given ring. Let's fix $P \in Z$ and let $A$ such that $(V_P, \locO_X|_{V_P}) \cong (\Spec(A), \locO_{\Spec(A)})$. Let $f$ be the homeomorphism $f: V_P \to \Spec(A)$.

	Let's observe that $Z \cap V_P$ is irreducible (as an open set of $Z \cap V_P$ is of the form $U \cap Z \cap V_P$ and then $(U_1 \cap Z \cap V_P) \cap (U_2 \cap Z \cap V_P) = (Z \cap V_P) \cap (Z \cap U_1) \cap (Z \cap U_2)$ which is non empty because it's the intersection of nonempty open sets of $Z$, which is irreducible.

	As $f$ is an homeomorphism, then $f(Z\cap V_P)$ is irreducible and closed (as a subset of $\Spec(A)$). As it is closed, $\exists \ia$ ideal of $A$ such that $f(Z \cap V_P) = V(\ia) = V(r(\ia))$. Now let $fg \in r(\ia) \imp fg \in \iq \, \, \forall \iq \in V(\ia) \imp D(fg) \cap V(\ia) = \varnothing$. As $D(fg) = D(f) \cap D(g)$ (Atiyah-MacDonald, exercise 1.17), then $(D(f) \cap V(\ia)) \cap (D(g) \cap V(\ia)) = \varnothing$. By irreducibility of $V(\ia)$, either $D(f) \cap V(\ia)$ or $D(g) \cap V(\ia)$ must be empty, so either $f$ or $g$ belong to $\iq, \, \, \forall \iq \in V(\ia)$. In conclusion, $r(\ia)$ is a prime ideal, that we will name $\ip$, and $f(Z \cap V_P) = V(\ip) = \overline{\{\ip\}}$, and $\ip$ is the only point of $\Spec(A)$ with this property. Then, $f^{-1}(\ip) = Q_P \in V_P \cap Z$, and as the closure of image is the image of the closure under an homeomorphism, then $\overline{\{Q_P\}} = Z \cap V_P$, where the closure here is the closure in $V_P$. Then, the closure of $Q_P$ in $Z$ is $\overline{\{Q_P\}} = Z \cap \overline{V_P}$.

	Now note that $Z \setminus (Z \cap \overline{V_P})$ and $Z \cap V_P$ are open sets of $Z$, and their intersection is empty. As $Z$ is irreducible, one of them must be empty. $Z \cap V_P$ is not empty, as $P$ belongs to this subset, so we must have $Z \setminus (Z \cap \overline{V_P}) = \varnothing \imp Z \cap \overline{V_P} = Z$. So, in conclusion, $\overline{\{Q_P\}} = Z$ and we have proved the existence of a generic point of $Z$. Now let's prove the uniqueness. Note that the point $Q_P$ is unique with this property in $V_P \cap Z$ (as $\ip$ was unique, as we already observed), but we could have a different point $Q_P$ for each open set $V_P$. However, as $\overline{\{Q_P\}} = Z, \, \, \forall P' \in Z$ and $\forall U$ open neighbourhood of $P'$, $Q \in U$. In particular, taking $U = V_{P'}$ we have that $Q_P \in V_{P'}$, and therefore $Q_P = Q_{P'}$ (via the composition of homeomorphisms from $V_P$ and $V_{P'}$ to the corresponding ring spectrums) and so the generic point is unique, $\exists \zeta = Q_P \, \, \forall P$ such that $Z = \overline{\{\zeta\}}$.
\end{sol}

\begin{ex}
	Describe $\Spec(\R[x])$. How does it compare to the set $\R$? To $\C$?
\end{ex}

\begin{sol}
	$\R$ is a field, and so $\R[x]$ is a principal ideal domain. Then, $\Spec(\R[x]) = (0) \cup \mathrm{Max}(\R[x])$. Then, the prime ideals of $\R[x]$ are the zero ideal and ideals of the form $(f)$, with $f$ an irreducible polynomial (which are all maximal ideals). Then $\Spec(\R[x])$ has a generic point $(0)$ and a closed point for each irreducible polynomial. We know that irreducible polynomials in $\R[x]$ can be of two types: $f = x-a$, with $a \in \R$, or $f = (x-(a+bi))(x-(a-bi))$, $a,b \in \R, b \neq 0$. Therefore, in $\Spec(\R[x])$ we have a closed point for each $a \in \R$ and a closed point for each pair of complex conjugates. $\Spec(\R[x])$ can thus be identified with the closed upper half plane plus a generic point $(0)$.
\end{sol}

\begin{ex}
	Let $k = \mathbb{F}_p$ be the finite field with $p$ elements. Describe $\Spec (k[x])$. What are the residue fields of its points? How many points are there with a given residue field?
\end{ex}

\begin{sol}
	As $k$ is a field, following the same reasoning of last exercise, the spectrum of $k[x]$ will consist of a closed point for each irreducible polynomial in $k[x]$ plus a generic point corresponding to the ideal $(0)$. There are irreducible polynomials in $k[x]$ of arbitrary degree $n$: Indeed, we can consider an extension of degree n of $\mathbb{F}_p$, $\mathbb{F}_{p^n}$. As the multiplicative group of $\mathbb{F}_{p^n}$ is finite, it is cyclic, so $\mathbb{F}_{p^n} = \{0, \alpha, \dots, \alpha^{p^{n-1}(p-1)} \}$, and then $\mathbb{F}_{p^n} = \mathbb{F}_p(\alpha)$. As $[\mathbb{F}_{p^n} : \mathbb{F}_p] = n$, then $\text{Irr}(\alpha, \mathbb{F}_p, x)$ has degree $n$.

	Then, given $f(x) \in k[x]$ irreducible of degree $n$, the residue field at the point corresponding to $(f)$ is $k[x]_{(f)} / (f)k[x]_{(f)}$. As localization and quotient commute, this field is the same as $(k[x]/(f))_{(f)}$, but $k[x]/(f)$ is already a field, ($\mathbb{F}_{p^n}$). So every element is already invertible, and when we localize we are not adding any elements. In conclusion, the residue field at the point corresponding to the ideal $(f)$ is $\mathbb{F}_{p^n}$, where $n$ is the degree of the polynomial. The residue field at the generic point $(0)$ is the field of fractions of the ring $\mathbb{F}_p$, that is, $\mathbb{F}_p(x)$. 

	Then, the number of points with a given residue field is exacly the same as the number of irreducible polynomials of $k[x]$ with a given degree $n$. This number is given by the expression $\frac{1}{n} \sum_{d \mid n} \mu(n/d) p^d$, where $\mu$ is the Möbius function: $\mu(n) = 0$ if $p^2 | n$ for a certain prime $p$, and $\mu(n) = (-1)^k$ otherwise, where $k$ is the number of different prime factors of $n$.
\end{sol}

\begin{ex}
	Glueing Lemma. Generalize the glueing procedure described in the text (2.3.5) as follows. Let $\{X_i\}$ be a family of schemes (possible infinite). For each $i \neq j$, suppose given an open subset $U_{ij} \subseteq X_i$, and let it have the induced scheme structure (Ex. 2.2). Suppose also given for each $i \neq j$ an isomorphism of schemes $\varphi_{ij}: U_{ij} \to U_{ji}$ such that (1) for each $i,j$ $\varphi_{ij} = \varphi_{ji}^{-1}$ and $(2)$ for each $i,j,k$, $\varphi_{ij}(U_{ij} \cap U_{ik}) = U_{ji} \cap U_{jk}$ and $\varphi_{ik} = \varphi_{jk} \circ \varphi_{ij}$ on $U_{ij} \cap U_{ik}$. Then show that there is a scheme $X$, together with morphisms $\psi_i: X_i \to X$ for each i, such that (1) $\psi_i$ is an isomorphism of $X_i$ onto an open subscheme of $X$, (2) the $\psi_i(X_i)$ cover $X$, (3) $\psi_i(U_{ij}) = \psi_i(X_i) \cap \psi_j(X_j)$ and (4) $\psi_i = \psi_j \circ \varphi_{ij}$ on $U_{ij}$. We say that $X$ is obtained by glueing the schemes $X_i$ along the isomorphisms $\varphi_{ij}$. An interesting special case is when the family $X_i$ is arbitrary, but the $U_{ij}$ and $\varphi_{ij}$ are all empty. Then the scheme $X$ is called the disjoint union of the $X_i$ and its denoted $\bigsqcup X_i$.
\end{ex}

\begin{sol}
	We will proceed as in 2.3.5. Let's consider $X$ the topological space $\bigsqcup X_i$ modulo the equivalence relation $\varphi_{ij}(x) = x$, $\forall x \in U_{ij}, \, \, \forall i,j$. We have maps $\psi_i$ which send each element $x \in X_i$ to its equivalence class in $X$. Then, we define a topology on $X$ as follows: A set $V \subseteq X$ is open if and only if $\psi_i^{-1}(V)$ is open for each $i$. Its clear that this topology makes the applications $\psi_i$ continuous.

	%The finest topology that makes the canonical projection map $\pi: \bigsqcup X_i \to X$, $x \mapsto \overline{x}$ continuous. Its clear that the inclusion maps $X_i \to \bigsqcup X_i$ are continuous, and therefore  (the composition of the inclusion and $\pi$), and they're continuous for being the composition of continuous applications. 

	Again following the developement of 2.3.5 we can define a sheaf of rings on $X$ as 
	\[
		\locO_X(V) = \{(s_i) \in \prod_i \locO_{X_i}(\psi_i^{-1}(V)) \text{ such that } \varphi_{ij}(s_i|_{\psi_i^{-1}(V) \cap U_{ij}}) = s_j|_{\psi_j^{-1}(V) \cap U_{ji}} \}
	\]
 
	Now, to avoid checking step by step that it is indeed a sheaf of rings, we will make use of Exercise 1.22. Note that $\psi_i(X_i)$ are open sets of $X$, as $\psi_j(\psi_i(X_i)) = X_i$ if $i = j$, and $U_{ji}$ if $j \neq i$. Then, we can define on $\psi_i(X_i)$ a sheaf by direct image, $(\psi_i)_* \locO_{X_i}$. Moreover, $\psi_i(X_i) \cap \psi_j(X_j)$ are the elements of $X$ that admit representatives both in $X_i$ and $X_j$, so $\psi_i(X_i) \cap \psi_j(X_j) = \psi_i(U_{ij}) = \psi_j(U_{ji})$. Therefore, we have isomorphisms of sheaves 
	\[
		\phi_{ij} := {\varphi_{ij}^{\#}}_* : (\psi_j)_* \locO_{X_j}|_{\psi_i(X_i) \cap \psi_j(X_j)} \to (\psi_i)_* \locO_{X_j}|_{\psi_i(X_i) \cap \psi_j(X_j)}
	\]

	And those morphisms satisfy $\phi_{ik} = \phi_{jk} \circ \phi_{ij}$ on $\psi_i(X_i) \cap \psi_j(X_j) \cap \psi_k(X_k)$. Then, we are under the situation of Exercise 1.22, and the sheaf we have defined on $X$ is the same as the sheaf defined by glueing the sheafs $(\psi_i)_* \locO_{X_i}$ defined in the open cover $\psi_i(X_i)$. So we already know that $\locO_X$ is a sheaf. 

	In addition, let's observe that $(\psi_i)_* \locO_{X_i}$ and $\locO_{X_i}$ are isomorphic sheaves, as $\psi_i$ is injective (the equivalence relation that defines $X$ only identifies points from different $X_i$, so each element of $X$ has at most one representative in $X_i$), so $\psi_i$ is an homeomorphism when we restrict the image to $\psi(X_i)$ instead of $X$.

	Moreover, it is clear that for each point $P \in X$, $P = \psi_i(Q)$ for a certain $i$ and $Q \in X_i$. Then, the ring $\locO_{X,P}$ is isomorphic to the local ring $\locO_{X_i, Q}$ and so it is local. Moreover, every point has an open set isomorphic to the spectrum of a ring (as the image of an open set of $X_i$ by $\psi_i$ is an open set of $X$). This proves that $(X, \locO_X)$ is a scheme.

	\vspace{3mm}

	Now let's consider the morphisms of shemes $(\psi_i, \psi_i^{\#}): (X, \locO_X) \to (X_i, \locO_{X_i})$, where $\psi_i^{\#}$ is the projection on the $i-th$ coordinate. We have already commented that $(X_i, \locO_{X_i})$ and $(\psi(X_i), (\psi_i)_*\locO_{X_i})$ are isomorphic schemes. We also know that $\locO_{X}|_{\psi_i(X_i)} \to (\psi_i)_*\locO_{X_i}$ is an isomorphism of sheaves by Exercise 1.22. Then the composition, which is $\psi_i^{\#}|_{\psi(X_i)}$ is an isomorphism of sheaves, and so we have that $(\psi_i, \psi_i^{\#})$ is an isomorphism of schemes from $X_i$ to an open subscheme of $X$, corresponding to $\psi_i(X_i)$. This proves property (1). We have already proven properties (2) and (3) earlier. With respect to (4), it follows from the fact that $\phi_{ik} = \phi_{jk} \circ \phi_{ij}$, which is proved in 1.22, toghether with the definition of the sheaf morphisms $\phi_{ij}$. 
\end{sol}

\begin{ex}
	A topological space is quasi-compact if every open cover has a finite subcover. 
	\begin{enumerate}[label=\alph*)]
		\item Show that a topological space is noetherian if and only if every open subset is quasi-compact.
		\item If $X$ is an affine scheme, show that $\mathrm{sp}(X)$ is quasi-compact, but not in general noetherian. We say that a scheme $X$ is quasi-compact if $\mathrm{sp}(X)$ is.
		\item If $A$ is a noetherian ring, show that $\mathrm{sp}(\Spec(A))$ is a noetherian topological space.
		\item Give an example to show that $\mathrm{sp}(\Spec(A))$ can be noetherian even when $A$ is not.
	\end{enumerate}
\end{ex}

\begin{sol}
	\begin{enumerate}[label=\alph*)]
		\item $\boxed{\Rightarrow}$ Let $X$ be a noetherian topological space. Every open subset $U$ of $X$ is noetherian, as open sets of $U$ are also open sets of $X$, so every ascending chain of open sets of $U$ must stabilize, and so $U$ is indeed noetherian. Then, it is enough to prove that a noetherian topological space is quasi-compact. Now let $\{U_{\alpha}\}$ be an open cover of $X$. Now let's build an ascending open chain: We pick an open set $U_1 \in \{U_{\alpha}\}$. If $U_1 \neq X$, there mus exist another open set $U_2 \in \{U_{\alpha}\}$ such that $U_2 \not\subseteq U_1$. Then $U_1 \subset U_1 \cup U_2$. Again, if $U_1 \cup U_2 \neq X$, $\exists U_3 \not\subseteq U_1 \cap U_2$. Repeating this steps inductively we build an ascending chain
		\[
			U_1 \subset U_1 \cup U_2 \subset \dots \subset \bigcup_{i = 1}^n U_i \subset \dots
		\]

		As $X$ is noetherian, the chain must stabilize at some point $m$ and so we must have $\bigcup_{i = 1}^m U_i = X$, so $X$ is quasi-compact.

		$\boxed{\Leftarrow}$ Consider a chain of open sets of $X$, $U_1 \subseteq U_2 \subseteq \dots \subseteq U_n \subseteq \dots$. Then $U = \bigcup_{i = 1}^\infty U_i$ is an open set, and $\{U_i\}_{i = 1}^{\infty}$ is an open cover of $U$. $U$ is quasi-compact as it is an open subset, so $\exists U_{i_1}, \dots U_{i_m}$ that cover $U$. Therefore, the chain stabilizes at point $i_m$, and therefore $X$ is noetherian.

		\item If $X$ is an affine scheme, then $X = \Spec(A)$ for a certain ring $A$. As the sets $D(f)$ form a base of the topology, every open covering of $X$ can be regarded as a basic open covering. So let $X = \bigcup_{i \in I} D(f_i) = \bigcup_{i \in I} X \setminus V(f_i) = X \setminus \bigcap_{i \in I} V(f_i)$. This happens if and only if $V(\bigcup_{i \in I}f_i = \bigcap_{i \in I} V(f_i) = \varnothing \iff$ the ideal generated by the elements $f_i$ is the whole ring $A$. That means that $\exists J$ a finite subset of $I$ such that $1 = \sum_{i \in J}g_i f_i$. Then, following the implications in the opposite direction, we have $\bigcap_{i \in J} V(f_i) = \varnothing \imp X \setminus \bigcap_{i \in J}V(f_i) = \bigcup_{i \in J} X \setminus V(f_i) = \bigcup_{i \in J} D(f_i) = X$. So the set $\{D(f_i)\}_{i \in J}$ is a finite open subcovering of $\{D(f_i)\}_{i \in I}$. That shows that $\mathrm{sp}(X)$ is quasi-compact.

		Now consider the ring $A = k[x_1, \dots, x_n \dots]$, that is a ring of polynomials with infinite indeterminates over a field $k$. The ideals $(x_1) \subset (x_1, x_2) \subset \dots \subset (x_1, x_2, \dots, x_n) \subset \dots$ are all prime and form an ascending chain that doesn't stabilize. Then, $V(x_1) \supset V(x_1, x_2) \supset \dots \supset V(x_1, x_2, \dots, x_n) \supset \dots$ is a descending chain of closed sets of $\text{sp}(X)$ which doesn't stabilize, and so the topological space is not noetherian.

		\item Let $V(\ia_1) \supseteq V(\ia_2) \supseteq \dots$ be a descending chain of closed sets in $\mathrm{sp}(\Spec(A))$. That means that we have a corresponding chain on ideals $r(\ia_1) \subseteq r(\ia_2) \subseteq \dots$. As the ring is noetherian, this chain must stabilize. Then, taking into account that $V(\ia) = V(r(\ia))$, the initial descending chain of closed sets also stabilizes, so the topological space $\Spec(A)$ $\mathrm{sp}(\Spec(A))$ is noetherian.

		\item Let's consider the ring $A = k[x_1, \dots, x_n \dots] / (x_1, x_2^2, \dots, x_n^n \dots)$. These ring has only one prime ideal, $(x_1, x_2, \dots, x_n, \dots)$, so $\mathrm{sp}(\Spec(A))$ has only one point, and therefore every descending chain of closed sets must stabilize and $\mathrm{sp}(\Spec(A))$ is noetherian. However, the chain of ideals of $A$ $(x_1) \subset (x_1, x_2) \subset \dots$ doesn't stabilize, and so $A$ is not a noetherian ring.
	\end{enumerate}

\end{sol}

\begin{ex}
	\begin{enumerate}[label=\alph*)]
		\item Let $S$ be a graded ring. Show that $\Proj(S) = \varnothing$ if and only if every element of $S_{+}$ is nilpotent.
		\item Let $\varphi: S \to T$ be a morphism of graded rings (preserving degrees). Let $U = \{\ip \in \Proj(T) | \ip \not\supseteq \varphi(S_+)\}$. Show that $U$ is an open subset of $\Proj(T)$, and show that $\varphi$ determines a natural morphism $f: U \to \Proj(S)$.
		\item The morphism $f$ can be an isomorphism even when $\varphi$ is not. For example, suppose that $\varphi_d: S_d \to T_d$ is an isomorphism for all $d \geq d_0$, where $d_0$ is an integer. Then show that $U = \Proj(T)$ and the morphism $f: \Proj(T) \to \Proj(S)$ is an isomorphism.
		\item Let $V$ be a projective variety with homogeneous coordinate ring $S$. Show that $t(V) \cong \Proj(S)$. 
	\end{enumerate}
\end{ex}

\begin{sol}
	\begin{enumerate}[label=\alph*)]
		\item Suppose that every element of $S_+$ is nilpotent, and let $\ip$ be an homogeneous prime ideal. Given $x \in S_+$, $x^n = 0 \in \ip$ for a certain integer $n$, so we must have $x \in \ip$. This means that $\ip \supseteq S_+$ and therefore $\Proj(S) = \varnothing$, as it is the set of homogeneous prime ideals that don't contain $S_+$. 

		Reciprocally, let now $\Proj(S) = \varnothing$. Let's first prove that every prime ideal $\ip$ contains an homogeneous prime ideal $\ip_h$, the one generated by the homogeneous elements of $\ip$. It is clear that $\ip_h$ is homogeneous and that $\ip_h \subseteq \ip$. We need to prove that $\ip_h$ is prime. Let $f,g$ such that $fg \in \ip_h$. As $S$ is a graded ring, then $f$ and $g$ admit a unique descomposition as a sum of homogeneous elements, $f = \sum_{i = 0}^n f_i$ and $g = \sum_{i = 0}^m g_i$. We have to prove that either $f$ or $g$ belong to $\ip_h$. We will proceed by induction on $n+m$. If $n = m = 0$, then, $fg \in \ip_h \subseteq \ip \imp$ $f$ or $g$ $\in \ip$, and as they're homogeneous elements, they belong to $\ip_h$. In the general case, $fg = f_n g_m + (\sum_{i = 0}^{n-1} f_i)(\sum_{i = 0}^{m-1} m_i) + f_n(\sum_{i = 0}^{m-1} g_i) + g_m(\sum_{i = 0}^{n-1} f_i)$. As the ideal $\ip_h$ is homogeneous, then the component of degree $i$ of $fg$ belongs to $\ip_h$ for each $i$. In particular, the component of degree $nm$, which is $f_n g_m$ belongs to $\ip_h \subseteq \ip$, so either $f_n$ or $g_m$ belong to $\ip$, and therefore $\in \ip_h$ as they're homogeneous. Suppose that $f_n \in \ip_h$. Then $\ip_h \ni fg - f_ng = (\sum_{i = 0}^{n-1} f_i)(\sum_{i = 0}^m g_i)$. Applying induction hypothesis, either $g$ or $f-f_n$ belong to $\ip_h$. As we already know that $f_n \in \ip_h$, then we have indeed that $f$ or $g$ belong to $\ip_h$, so it is a prime ideal.

		The fact that every prime ideal contains an homogeneous prime ideal implies that the nilradical of $S$ van be calculated as the intersection of all homogeneous prime ideals. As $\Proj(S) = \varnothing$, every homogeneous prime ideal contains $S_+$, and therefore the nilradical contains $S_+$, so every element of $S_+$ is nilpotent.

		\item If $\varphi$ is a graded morphism, the image of an homogeneous element is homgeneous, and therefore, if $\ia$ is an homogeneous ideal of $S$, $\varphi(\ia)^e$ is an homogeneous ideal of $T$. Note also that $\ip \supseteq \varphi(\ia)^e \iff \ip \supseteq \varphi(\ia)$. Then, $V(\varphi(S_+)^e)$ is a closed subset of $\Proj(T)$ and therefore its complementary, which is $U$, is open.

		It is clear that $\varphi$ defines an application between prime ideals of $T$ and prime ideals of $S$, that maps $\ip \mapsto \varphi^{-1}(\ip)$. The contraction of an homogeneous ideal $\ip$ is homogeneous: Indeed, let $f = f_0 + \dots + f_n$ such that $\varphi(f) = x$, with $x$ homogeneous of degree $d$, then $\varphi(f_i) = 0$ if $i \neq d$ and $\varphi(f_i) = x$ if $i = d$. So $f_i, \, i \neq d \in \varphi^{-1}(\ip)$ as they belong to the kernel of $\varphi$ and $f_d \in \varphi^{-1}(x)$. So the components of each element of $\varphi^{-1}(\ip)$ belong to the ideal, and therefore $\varphi^{-1}(\ip)$ is homogeneous. This means that we can restrict the application between prime ideals of $T$ and prime ideals of $S$ to homogeneous prime ideals. In addition, $\ip \not\supseteq \varphi(S_+) \imp \imp \varphi^{-1}(\ip) \not\supseteq \varphi^{-1}(\varphi(S_+))$. We know that $\varphi^{-1}(\varphi(S_+)) \supseteq S_+$. But $\varphi(S_+)$ doesn't have elements of degree $0$, so its antiimage doesn't have elements of degree $0$, which means that $\varphi^{-1}(\varphi(S_+)) = S_+$. In conclusion, $\ip \not\supseteq \varphi(S_+) \imp \varphi^{-1}(\ip) \not\supseteq S_+$. Then, the images of elements of $U$ belong to $\Proj(S)$, so when we restrict the application $\varphi^{-1}$ to $U$ we obtain an application $f: U \to \Proj(S)$.

		Now let's check that this is a continuous map between the corresponding topological spaces (with $U$ having the induced topology by $\Proj(T)$). It is enough to check that the antiimage of a basic open set is open. Let $D_+(h)$ be a basic open subset of $\Proj(S)$, (with $h \in S$). Then, $f^{-1}(D_+(h)) = \{\ip \in U \text{ such that } h \notin \varphi^{-1}(\ip) \}$ As $h \notin \varphi^{-1}(\ip) \iff \varphi(h) \notin \ip$, then $f^{-1}(D_+(h))$ is equal to $D_+(\varphi(h)) \cap U$, which is open in $U$. Then the application $f$ is indeed continuous.

		Let's define an associated morphism of sheaves as follows: $f^{\#}: \locO_{\Proj(S)} \to f_*\locO_{\Proj(T)}|_U$. Given an application $s: V \to \bigsqcup_{\ip \in V} S_{(\ip)} \in \locO_{\Proj(S)}$ we map it to the application $f^{\#}(s) = \varphi_{\ip} \circ s \circ f: f^{-1}(V) \to \bigsqcup_{\ip \in f^{-1}(V)} T_{(\ip)}$, where $\varphi_{\ip}: S_{\varphi^{-1}(\ip)} \to T_{\ip}$ is the localization of $\varphi$ (as $\varphi$ preserves degrees, $\varphi_{\ip}$ also does, and therefore takes elements of degree zero to elements of degree zero, and so $f^{\#}$ is well defined). $f^{\#}$ is in addition a morphism of locally ringed spaces, as the induced applictions on stalks are the local ring morphisms $\varphi_{\ip}$. In conclusion, $(f, f^{\#})$ is a morphism of schemes between $U$ and $\Proj(S)$.

		\item If $\ip \supseteq \varphi(S_+)$ and $\varphi_d$ is an isomorphism, then $\ip \supseteq T_d$, $\forall d \geq d_0$. Now, given $x \in T_+$, $\exists n$ such that $x^n \in \ip$ ($n$ such that $n \mathrm{deg}(x) \geq d_0$). As $\ip$ is prime, $x^n \in \ip \imp x \in \ip$. So $\ip \supseteq \varphi(S_+) \iff \ip \supseteq T_+$, and therefore $U = \Proj(T)$.

		Let's observe that every $\ip$ homogeneous prime ideal of $S$ that doesn't contain $S_+$ cannot contain all $S_d$ for arbitrary degree $d \geq d_0$, as therefore, $\forall x \in S_d, d > 0, \exists n$ such that the degree of $x^n$ is $\geq d_0$, and thereore $x^n \in \ip \imp x \in \ip$, and all $S_+$ is contained in $\ip$, which is a contradiction. We will use this fact (Observation 1) several times. Now let's proceed to prove that $f$ is a morphism of schemes.

		\begin{itemize}
			\item $f$ is injective: Let $\ip, \iq$ homogeneous prime ideals of $T$ such that $f(\ip) = f(\iq) \iff \varphi^{-1}(\ip) = \varphi^{-1}(\iq)$. Let $x \in \ip$ homogeneous of degree $> 0$. Then, $\exists n$ such that $d:= \mathrm{deg}(x^n) \geq d_0$. Then, as $\varphi_d$ is an isomorphism, $\exists! a \in \varphi_d^{-1}(x^n) \subseteq \varphi_d^{-1}(\ip \cap T_d) = \varphi^{-1}(\iq \cap T_d)$. Therefore, $\varphi_d(a) = x^n \in \iq \imp x \in \iq$ as $\iq$ is prime. Now let $x \in \ip$ of degree $d = 0$. Now let's take y of homogeneous of degree $\geq d_0$, $y \notin \iq$, which exists by Observation 1. Then, $yx \in \ip$ has degree $\geq d_0$ and therefore $\exists! a \in S_d$ such that $a \in \varphi^{-1}(xy) \in \varphi^{-1}(\ip) = \varphi^{-1}(\iq)$. That implies that $xy \in \iq$, but as $y \notin \iq$ and $\iq$ is prime, then $x \in \iq$. This proves $\ip \subseteq \iq$ and by the symmetric argument, the two ideals are equal so $f$ is injective.

			\item $f$ is surjective: Let $\ip$ be a prime ideal of $\Proj (S)$. Let $\iq$ be the ideal generated by the homogeneous elements of $T$ such that $x^n \in \varphi(\ip)$ for a certain $n$, or homogeneous elements of degree zero of $T$ such that $xy \in \varphi(\ip)$ for a certain $y$ such that $y \notin \varphi(\ip)$. The ideal $\iq$ is homogeneous (because it's generated by homogeneous elements). Let's check that it is a prime ideal: Given $x,y$ homogeneous elements of degree $\geq 1$, such that $xy \in \iq \imp \exists n$ such that $(xy)^n \in \varphi(\ip)$. We can assume that $n \geq d_0$ as $a^n \in \varphi(\ip) \imp a^{nm} \in \varphi(\ip) \, \, \forall m \geq 1$. Then, as $x^n$ and $y^n$ are elements of $T_d$, $d \geq 0$, and $\varphi_d$ is surjective $\imp \exists! a,b \in S$ such that $\varphi(a) = x^n, \, \varphi(b) = y^n$. Then $\varphi(ab) \in \varphi(\ip)$ and as $\varphi_d$ is injective for $d \geq d_0$, then $ab \in \ip$. As $\ip$ is prime either $a$ or $b \in \ip \imp x^n$ or $y^n$ belong to $\varphi(\ip)$ and therefore $x$ or $y$ belong to $\iq$. Now let $x$ have degree zero, and $xy \in \iq$. If $y$ has degree $0$, then this means that $\exists z$ such that $xyz \in \varphi(\ip)$. Then $yz$ has degree $d$ and $x(yz) \in \varphi(\ip)$, which means that $x \in \iq$. If $y$ has degree different from $0$, then $(xy)^n \in \varphi(\ip)$. If $y^n \notin \varphi(\ip)$ then $x \in \iq$. If $y^n \in \varphi(\ip)$, then $y \in \iq$. In conclusion, $\iq$ is a prime ideal.

			Now let $x \in \iq$. If $\mathrm{deg}(x) \geq 1$ then $\exists n$ such that $x^n \in \varphi(\ip) \imp x^n = \varphi(a)$, with $a \in \ip$. Let $b \in \varphi^{-1}(x)$. Then, $\varphi(b^n) \in \varphi(\ip) \imp b \in \ip$ (by observation 2). If $\mathrm{deg}(x) = 0$, then $\exists y \notin \varphi(\ip)$, $y \in T_d$, $d \geq d_0$ such that $xy \in \varphi(\ip)$. As $\varphi_d$ is an isomorphism, then $\exists! a \in S_d \cap \ip$ such that $\varphi(a) = xy$, and $\exists! b \in S_d, b \notin \ip$ such that $\varphi(b) = y$. Let $c \in \varphi^{-1}(x)$. Then $\varphi(cb) = \varphi(a) \imp cb = a \in \ip$ but $b \notin \ip \imp c \in \ip$. With this reasoning we have proved that $\varphi^{-1}(\iq) \subseteq \ip$. Reciprocally, given $x$ an homogeneous element of $\ip$, $\varphi(x) \in \varphi(\ip) \imp \varphi(x) \in \iq$ and this means that $x \in \varphi^{-1}(\varphi(x)) \in \varphi^{-1}(\iq)$. This proves that $\ip \subseteq \varphi^{-1}(\iq)$. In conclusion, we have found an homogeneous ideal $\iq$ such that $\varphi^{-1}(\iq) = \ip$, so $f$ is surjective.

			\item $f^{-1}$ is continuous: It is enough to check that the antiimage of a basic open subset is open. Let $h \in T$ and consider the basic open subset $D_+(h)$. Note that $D_+(h) = D_+(h^n)$, so if $h$ has degree $\neq 0$, for a given $n$, $h^n$ has enough degree such that $h^n \notin \ip \iff \varphi^{-1}(h^n) \notin \varphi^{-1}(\ip)$, and therefore, $(f^{-1})^{-1}(D_+(h)) = D(\varphi^{-1}(h^n))$. If $\mathrm{deg}(h) = 0$, then $h \in \ip \iff \exists y \notin \ip$ such that $yh \in \ip$. Then we can choose an element $y$ of degree atleast $d_0$ by Observation 1, and therefore $(f^{-1})^{-1}(V(h)) = (f^{-1})^{-1}(V(yh)) = V(\varphi^{-1}(yh))$. Then, $(f^{-1})^{-1}(D_+(h)) = D_+(\varphi^{-1}(yh))$. In conclusion, the antiimage of an open set is open, and $f^{-1}$ is continuous.
			Since now we have proven that $f$ is an homeomorphism. 

			\item $f^{\#}$ is an isomorphism of sheaves: First let's prove injectivity. Suppose that we have two applications $s,s' \in \locO_{\Proj(S)}(V)$ such that $f^{\#}(V)(s) = f^{\#}(V)(s')$. Now let $\ip$ be a prime of $f^{-1}(V)$ and $f(\ip) \in V$. Let $s(f(\ip)) = \frac{a}{t}$ and $s'(f(\ip)) = \frac{a'}{t'}$. Then, $(f^{\#}(V)(s))(\ip) =  (f^{\#}(V)(s'))(\ip) \imp \frac{\varphi(a)}{\varphi(t)} = \frac{\varphi(a')}{\varphi(t')}$. That happens if and only if $\exists y \notin \ip$ such that $y(\varphi(at')-\varphi(a't)) = 0$. Note that we can multiply this expression by elements of higher degree ans it is still zero. Then, by observation 1, we can suppose that $\mathrm{deg}(y) = d \geq d_0$ and therefore $\exists x \in S_d, \, x \notin f(\ip)$ such that $\varphi(at'x)-\varphi(a'tx) = 0$. As $a'tx$ and $at'x$ are homogeneous elements with degrees higher that $d_0$, then $\varphi$ is injective and $at'x = a'tx \imp x(at'-a't) = 0 \imp \frac{a}{t} = \frac{a'}{t'}$ in $S_{(f(\ip))}$. As this is valid for every prime $\ip$, $s = s'$, and $f^{\#}$ is injective. 

			To prove surjectivity we will prove surjectivity of the induced applications on stalks, that are $\varphi_{\ip}$. Indeed, given $\frac{a}{t} \in T_{(\ip)}$, $\exists y \notin \ip$ with $\mathrm{deg}(y) = d \geq d_0$. Then, $\frac{a}{t} = \frac{ay}{ty}$. As $\varphi_d$ is surjective $\forall d \geq d_0$ and $ay, ty \in T_d$, with $d \geq d_0$, then $\exists a', t' \in S_d$, $t' \notin f(\ip)$, such that $ay = \varphi(a')$ and $ty = \varphi(t')$. Then $\frac{a}{t} = \varphi_{\ip}(\frac{a'}{t'})$ and so $\varphi_{\ip}$ is surjective.
		\end{itemize}

		\item By the projective version of the Nullstellensatz (Problem 2.4 of Chapter I), we have a bijective correspondence between irreducible closed subsets of $V$ and homogeneous prime ideals of $S$ that don't contain all $S_+$. It is given by $f: t(V) \to \Proj(S)$, $Y \mapsto I(Y)$. If $\ia$ is a radical ideal, $Y$ an irreducible closed set, then $I(Y) \supseteq \ia \iff Y = Z(I(Y)) \subseteq Z(\ia) \iff Y \in t(Z(\ia))$. Then, $f^{-1}(V(\ia)) = \{\text{irreducible closed sets such that } I(Y) \supseteq \ia \} = t(Z(\ia))$, which is a closed subset. This proves that $f$ is continuous. Moreover, $f^{-1}: \Proj(S) \to t(V)$, $\ip \mapsto Z(\ip)$ and we have that $Z(\ip) \subseteq t(Z(\ia))$, with $\ia$ radical $\iff Z(\ip) \subseteq Z(\ia) \iff \ip = I(Z(\ip)) \supseteq I(Z(\ia)) = \ia$. Then, $f^{-1}(t(Z(\ia))) = V(\ia)$, so $f^{-1}$ is also continuous and therefore $f$ is an homeomorphism.

		Now let's build an associated morphism of sheaves, $f^{\#}: \locO_{\Proj(S)} \to f_*(\alpha_* \locO_V)$, where $\alpha: V \to t(V)$ such that $P \mapsto \overline{\{P\}}$. Given $U$ an open set of $\Proj(S)$, we define $f^{\#}(U)$ mapping a section $s$ to a section $s' \in f_*\alpha_* \locO_V(U)$, defined as follows: For every $P \in \alpha^{-1}(f^{-1}(U))$, we define $s'(P)$ taking the image $s(f(\alpha(P))) \in S_{(f(\alpha(P)))}$, which is isomorphic to $\locO_{V,P}$ (Using theorem 3.4 of chapter I, which states that $\locO_{V,P} \cong S_{(\im_P)}$ and the fact that a regular function that vanishes at $P$ vanishes at the whole closure, so $\im_P = f(\alpha(P))$). Then we pass to the quotient ring $S_{(f(\alpha(P)))}/f(\alpha(P))$, which is isomorphic to $k$. This is an isomorphism of sheaves, as the induced morphisms on stalks are in fact the local isomorphisms between $\locO_{V,P}$ and $S_{(f(\alpha(P)))}$. In conclusion, $(f,f^{\#}): (t(V), \alpha_*(\locO_V)) \to (\Proj(S), \locO_{\Proj(S)})$ is an isomorphism of schemes, so $t(V) \cong \Proj(S)$.		
	\end{enumerate}
\end{sol}

\begin{ex}
	\begin{enumerate}[label=\alph*)]
		\item Let $V$ be a variety over the algebraically closed field $k$. Show that a point $P \in t(V)$ is a closed point if and only if its residue field is $k$.

		\item If $f: X \to Y$ is a mosphism of schemes over $k$, and if $P \in X$ is a point with residue field $k$, then $f(P) \in Y$ has also residue field $k$.

		\item Now show that if $V,W$ are any two varieties over $k$, then the natural map
		\[
			\Hom_{\mathfrak{Var}}(V,W) \to \Hom_{\mathfrak{Sch/k}(t(V),t(W))}
		\]

		is bijective.
	\end{enumerate}
\end{ex}

\begin{sol}
	\begin{enumerate}[label=\alph*)]
		\item Note that the sheaf defined in $t(V)$ is $\alpha_*\locO_V$. An open set of $V$ is the complementary of a closed set, so they're of the form $U = \{P \in t(V) \text{ such that } Z_P \not\subseteq Y \}$, where $Y$ is a given closed set of $V$. That is equivalent to $U = \{P \in t(V) \text{ such that } Z_P \cap W \neq \varnothing \}$, where $W = V \setminus Y$ is an open set of $V$. Then, $\alpha^{-1}(U) = \{p \in V \text{ such that } \overline{\{p\}} \cap W \neq \varnothing \}$. Note that $\overline{\{p\}} \cap W \neq \varnothing \iff p \in W$. 

		After these observations we know that the stalk of $P \in t(V)$ is 
		\[
			\locO_{t(V),P} = \varinjlim_{P \in U} \locO_{t(V)}(U) = \varinjlim_{P \in U} \alpha_* \locO_{V}(U) = \varinjlim_{Z_P \cap W \neq \varnothing} \locO_{V}(W)
		\]


		A point $P \in t(V)$ corresponds to an irreducible closed set $Z_P \subseteq V$, and it is closed if and only if there exists a closed $Y \subseteq V$ such that $P = t(Y)$, that is, $Z_P$ is the only irreducible closed set contained in $Y$. If that happens, $t(Y) = t(Z_P)$ because $Z_P$ itself is closed. If $P$ is closed, $\nexists Z \subseteq Z_P$ such that $Z$ is an irreducible closed set. As $Z_P$ is closed, then $\overline{\{Q\}} \subseteq Z_P$ for every $Q \in Z_P$. But the closure of a point of $V$ is an irreducible closed set, so if $P$ is closed we must have $\overline{\{Q\}} = Z_P$ for every $Q \in Z_P$. Then, $\forall W$ such that $W \cap Z_P \neq \varnothing$ we have that $W \cap \overline{\{Q\}} = \varnothing$ so $Q \in W$. That means that $Z_P \cap W \neq \varnothing \iff Q \in W$ for a certain $Q \in Z_P$. Then, the stalk of $P$ in $t(V)$ becomes 
		\[
			\locO_{t(V),P} = \varinjlim_{Z_P \cap W \neq \varnothing} \locO_{V}(W) = \varinjlim_{Q \in W} \locO_{V}(W) = \locO_{V,Q}
		\]

		And as $V$ is a variety, all local rings $\locO_{V,Q}$ have residue field $k$, so $\locO_{t(V),P} / \im_P = \locO_{V,Q}/\im_Q = k$, and $P$ has residue field $k$.

		An irreducible closed set $Z_P$ is a subvariety of $V$, and if $P$ is not closed it contains other subvarieties, which means that $Z_P$ is not a point. Then, the stalk of $P \in t(V)$ is $\varinjlim_{Z_P \cap W \neq \varnothing} \locO_{V}(W)$, which are pairs $(U,f)$, $Z_P \cap U \neq \varnothing$ and $f$ regular function of $U$, with the usual equivalence relation that two pairs are equal if the functions are equal on the intersection. A function is invertible on a point if and only if it is not zero at that point, so an element of $\locO_{t(V),P}$ is invertible if and only if $f(Q) \neq 0, \, \, \forall Q \in Z_P$. So the maximal ideal of the stalk is $\im_P =  \{(U,f) \in \locO_{t(V),P} \text{ such that } f(P) \neq 0 \, \, \forall P \in U \cap Z_P \}$. Then, the residue field is equal to the field of regular functions (as defined on Chapter I, 3.1). If $K(Z_P) = k \imp I(Z_P)$ is a maximal ideal, and by the weak nullstellensatz that means $Z_P$ is only one point, which is a contradiction ($\imp P$ is closed).

		\item A scheme over $k$ induces via the associated morphism of sheaves, local morphisms on stalks. The stalk of $\Spec(k)$ at the only point of the space is the field $k$ so we have morphisms of rings $k \to \locO_{X,P}$ for each $P$ in $X$, because $X$ is a scheme over $k$. Similarly, for each $Q \in Y$ we have a morphism $k \to \locO_{Y,Q}$. The projection into the residue field $\locO_{Y,Q}/\im_{f(P)} = k(f(P))$ is then a homomorphism of fields, and so it is injective and $k(f(P))$ contains a field isomorphic to $k$. On the other hand, the morphism $f: X \to Y$ induces local morphisms on stalks $\locO_{Y, f(P)} \to \locO_{X,P}$. As these are local morphisms, we have an induced application $k(f(P)) = \locO_{Y,f(P)}/\im_{f(P)} \to \locO_{X,P}/\im_P = k$ if $P$ is a point of residue field $k$. So we have an injective application $k(f(P)) \to k$ and so $k$ contains a field isomorphic to $k(f(P))$. In conclusion, $k(f(P)) \cong k$, so $f(P)$ also has residue field $k$.
	\end{enumerate}
\end{sol}



\begin{ex}
	Let $X$ be a scheme, let $f \in \Gamma(X, \locO_X)$, and define $X_f$ to be the subset of points $x \in X$ such that the stalk $f_x$ of $f$ at $x$ is not contained in the maximal ideal $\im_x$ of the local ring $\locO_x$.
	\begin{enumerate}[label=\alph*)]
		\item If $U = \Spec(B)$ is an open affine subscheme of $X$, and if $\overline{f} \in B = \Gamma(U, \locO_X|_U)$ is the restriction of $f$, show that $U \cap X_f = D(\overline{f})$. Conclude that $X_f$ is an open subset of $X$.

		\item Assume that $X$ is quasi-compact. Let $A = \Gamma(X, \locO_X)$, and let $a \in A$ be an element whose restriction to $X_f$ is $0$. Show that for some $n > 0, \, f^n a = 0$. [Hint: Use an open affine cover of $X$.]

		\item Now assume that $X$ has a finite cover by open affines $U_i$ such that each intersection $U_i \cap U_j$ is quasi-compact. (This hypothesis is satisfied, for example, if $\mathrm{sp}(X)$ is noetherian.) Let $b \in \Gamma(X_f, \locO_{X_f})$. Show that for some $n > 0, \, f^n b$ is the restriction of an element of $A$.

		\item With the hypothesis of (c), conclude that $\Gamma(X_f, \locO_{X_f}) \cong A_f$
	\end{enumerate}
\end{ex}

\begin{sol}
	\begin{enumerate}[label=\alph*)]
		\item If $U = \Spec(B)$, then every point $x \in U$ can be identified with a prime ideal $\ip_x \in \Spec(B)$, and $\locO_{x} = B_{\ip_x}$. Then, $x \in D(\overline{f}) \iff \overline{f} \notin \ip_x \iff$ the image of $\overline{f}$ is a unit in $B_{\ip_x} = \locO_{x} \iff (X,f) = (U, \overline{f}) \notin \im_x \iff x \in X_f$. Then, $X_f \cap U = D(\overline{f})$.

		As $X$ is a scheme, then it admits an open cover of affine subschemes $U_i = \Spec(B_i)$ and $\bigcup_{i \in I} U_i = X$. So $X_f = \bigcup_{i \in I} (U_i \cap X_f) = \bigcup_{i \in I} D(f_i)$, where $f_i = f|_{U_i}$. So $X_f$ is a union of open sets and therefore open.

		\item Let $\{U_i\}$ be an open affine cover of $X$, that we can take finite as $X$ is quasi-compact. That is, $X = \bigcup_{i = 1}^n U_i$ and $X_f = \bigcup_{i = 1}^n(U_i \cap X_f)$. Let $f_i = f|_{U_i}$ and by (a), $U_i \cap X_f = D(f_i)$. Then, $a|_{X_f} = 0 \imp a|_{D(f_i)} = 0$. From exercise 2.1 we know that $\Gamma(D(f_i), \locO_X|_{D(f_i)}) \cong (B_i)_{f_i}$, where $B_i = \Gamma(U_i, \locO_X|_{U_i})$. Then, $a|_{D(f_i)} = 0 \imp \frac{a|_{U_i}}{1} = 0$ in $(B_i)_{f_i}$. But this happens if and only if $\exists n_i$ such that $a|_{U_i}f_i^{n_i} = 0$. Now let $n = \mathrm{max}_i(n_i)$ and we have that $(af^n)|_{U_i} = a|_{U_i}f_i^{n} = 0$, which means that $af^n = 0$.

		\item Let $b \in \Gamma(X_f, \locO_{X_f})$. For each $U_i$, $b|_{D(f_i)}$ can be identified with an element of $(B_i)_{f_i}$ (we are still using the notation defined in (b)). Suppose that this element is $\frac{b_i}{f^{n_i}}$, for a certain $b_i \in B_i, n_i \geq 0$. Then let $m_1 = \mathrm{max}(n_i)$ and we have that $(bf^{m_1})|_{D(f_i)}$ has image in $(B_i)_{f_i}$ equal to $\frac{b_i (f_i)^{n-n_i}}{1}$, which is equal to the restriction of $c_i := b_i (f_i)^{n-n_i} \in B_i$ to $D(f_i)$. So we have found elements $c_i \in B_i$ such that their restriction to $D(f_i)$ is $(f_i)^{m_1}b|_{D(f_i)}$.

		Now $U_i \cap U_j$ is quasi compact. The element $c_i|_{U_i \cap U_j} - c_j|_{U_i \cap U_j}$ satisfies that its restriction to $(U_i \cap U_j)_{f|_{U_i \cap U_j}}$ is zero, as $c_i|_{X_f \cap U_i \cap U_j} = (bf^n)|_{U_i \cap U_j \cap X_f} = c_j|_{X_f \cap U_i \cap U_j}$. So, using the result obtained in (b), $\exists m_2$ such that $f^{m_2}|_{U_i \cap U_j}(c_i|_{U_i \cap U_j} - c_j|_{U_i \cap U_j}) = 0$. Then, $f_i^{m_2}c_i$ are elements of $B_i$ satisfying that their restrictions to $U_i \cap U_j$ agree. As $U_i$ is an open cover, $\exists! a \in A$ such that $a|_{U_i} = f_i^{m_2}c_i$. As $a|_{U_i \cap X_f} = f_i^{m_1 + m_2}|_{U_i \cap X_f}b|_{U_i \cap X_f} = (f^{m_1+m_2}b)|_{U_i \cap X_f}$, and $X_f \cap U_i$ is an open cover of $X_f$, then $f^{n}b = a|_{X_f}$, where we have defined $n: = m_1 + m_2$ (we are making a little abuse of notation here that the statement of the problem also does, as we are denoting both $f$ and its restriction to $X_f$ as $f$).

		\item With the result obtained in (c), we can define an application $\varphi: \Gamma(X_f, \locO_{X_f}) \to A_f$ such that $b \mapsto \frac{a}{f^n}$, where $a$ and $n$ are such that $f^nb = a|_{X_f}$. From the construction of (c) we can deduce that $\varphi$ is a ring morphism and it is injective (by the uniqueness of the element $a$ given a certain $n$ satisfying the property). Moreover, it is surjective because given any $a/f^n \in A_f$, the element $b = (f^n)^{-1}a|_{X_f}$ belongs to $\Gamma(X_f, \locO_{X_f})$, as $f$ is invertible in this ring (because it is invertible when restricted to the open cover $X_f \cap U_i$), and $b \mapsto \frac{a}{f^n}$.
		%Caldria veure que si hi ha més d'una possible a,n, diferenxen només en potències de f i per tant, la imatge en A_f es la mateixa.
	\end{enumerate}
\end{sol}

\begin{ex}
	A Criterion for Affineness.
	\begin{enumerate}[label=\alph*)]
		\item Let $f: X \to Y$ be a morphism of schemes, and suppose that $Y$ can be covered by open subsets $U_i$, such that for each $i$, the induced map $f^{-1}(U_i) \to U_i$ is an isomorphism. Then $f$ is an isomorphism.

		\item An scheme $X$ is affine if and only if there is a finite set of elements $f_1, \dots, f_r$ such that the open subsets $X_{f_i}$ are affine, and $f_1, \dots, f_r$ generate the unit ideal in $A$.
	\end{enumerate}
\end{ex}

\begin{sol}
	\begin{enumerate}[label=\alph*)]
		\item Let $f_i: f^{-1}(U_i) \to U_i$ be the restriction of $f$ to $f^{-1}(U_i)$. $f$ is injective, as given $x,y$ such that $f(x) = f(y)$, then $f(x) \in U_i$ for a certain $i$, and then $x,y \in f^{-1}(U_i)$. As $f_i$ is injective, $x = y$, so $f$ is injective. $f$ is surjective because given $y \in Y$, $y \in U_i$ for a certain $i$, so $\exists x \in f^{-1}(U_i) \subseteq X$ such that $f(x) = f_i(x) = y$, because $f_i$ is surjective. Moreover, $(f^{-1})^{-1}(V) = f(\bigcup_i V\cap f^{-1}(U_i)) = \bigcup_i f(V\cap f^{-1}(U_i)) = \bigcup_i f_i(V\cap f^{-1}(U_i))$ which is open because $f_i$ is an homeomorphism. In conclusion, $f$ is an homeomorphism.

		Now let's check that $f^{\#}: \locO_Y \to f_* \locO_X$ is an isomorphism of sheaves. We know that $f_i^{\#}$ are isomorphisms. Let $V$ be an open set of $Y$. Let $s,t \in \locO_Y(V)$ such that $f^{\#}(V)(s) = f^{\#}(V)(t) \imp f^{\#}(V)(s)|_{U_i \cap V} = f^{\#}(V)(t)|_{U_i \cap V} \imp f^{\#}(V \cap U_i)(s|_{U_i \cap V}) =  f^{\#}(V \cap U_i)(t|_{U_i \cap V}) \imp f_i^{\#}(V \cap U_i)(s|_{U_i \cap V}) =  f_i^{\#}(V \cap U_i)(t|_{U_i \cap V}) \imp s|_{U_i \cap V} = t|_{U_i \cap V}$ for each $i$. Then, as $\{U_i \cap V\}$ is an open covering of $V$, $s = t$. Moreover, as $f_i^{\#}$ are isomorphisms (and therefore surjective), the charecterization of Exercise 1.3(a) is satisfied and therefore $f^{\#}$ is surjective.

		\item First let's observe that, if $(f_1, \dots, f_r) = (1)$, then we have $\bigcup_{i = 1}^r X_{f_i} = X$. Indeed, suppose that $\exists \ip_x$ such that $\ip_x \notin X_{f_i} \, \, \forall i \imp (f_i)_{x} = 0 \, \, \forall i$. But as $(f_1, \dots, f_r) = 1$ then $\exists a_1, \dots a_r$ such that $\sum_{i} a_i f_i = 1 \imp 1 = 1_x = (\sum_{i = 1}^r a_i f_i)_x = \sum_{i = 1}^r (a_i)_x(f_i)_x = 0$, which is a contradiction. As $X_{f_i}$ is an affine open subset, then $X_{f_i} \cap X_{f_j} = D(\overline{f_j})$, where $\overline{f_j} = f_j|_{X_{f_i}}$. By problem 2.16 (a), then $X_{f_i} \cong \Spec(B_i)$ and so $X_{f_i} \cap X_{f_j} \cong \Spec(B_i)_{\overline{f_j}}$, by problem 2.1.

		In particular, $X_{f_i} \cap X_{f_j}$ is affine and therefore it is quasi-compact by problem 2.13(b). Then, we are under the hypothesis of 2.16(c)(d), when the open affine cover here is the $X_{f_i}$. Then, as $\Gamma(X_{f_i}, \locO_X|_{X_{f_i}}) \cong A_{f_i}$ by 2.16(d), and $X_{f_i}$ is affine, then $X_{f_i} \cong \Spec(A_{f_i})$. Now let's observe that $D(f_i)$ are open sets of $\Spec(A)$, which form a cover of $\Spec(A)$. Indeed, suppose that $\bigcup_{i} D(f_i) \neq X \imp \exists \ip$ such that $\ip \notin D(f_i) \, \, \forall i$. Then, $\ip \in X \setminus \bigcup_{i} D(f_i) = \bigcap_i (X \setminus D(f_i)) = \bigcap_i V(f_i) = V(\bigcup f_i) = V((f_1, \dots, f_r)) = V(1) = \varnothing$. Now, as $A = \Gamma(X, \locO_X)$, the identity morphism of rings $Id: A \to \Gamma(X, \locO_X)$ induces a morphism of schemes $f: X \to \Spec(A)$, by problem 2.4, which is given by $P \mapsto Id^{-1}_P(\im_P) = \{a \in A \text{ such that } a_P \in \im_P\}$. Then, $f^{-1}(D(f_i)) = X_{f_i}$ because $f \notin Id^{-1}(\im_P) \iff f_P \notin \im_P$. The restriction of $f$ to $X_{f_i}$, $f: X_{f_i} \to D(f_i)$ is an isomorphism for each $i$, because $X_{f_i} \cong \Spec(A_{f_i}) \cong D(f_i)$ and the composition $D(f_i) \to \Spec(A_{f_i}) \to X_{f_i} \to D(f_i)$ is the identity, and the applications on stalks are also the identity. Then, using (a), $f$ is also an isomorphism of schemes, and so $X \cong \Spec(A) \imp X$ is affine.
	\end{enumerate}
\end{sol}

\begin{ex}
	In this exercise, we compare some properties of a ring homeomorphism to the induced morphism of the spectra of the rings.
	\begin{enumerate}[label=\alph*)]
		\item Let $A$ be a ring, $X = \Spec(A)$, and $f \in A$. Show that $f$ is nilpotent if and only if $D(f)$ is empty.

		\item Let $\varphi: A \to B$ be a homeomorphism of rings, and let $f: Y = \Spec(B) \to X = \Spec(A)$ be the induced morphism of affine schemes. Show that $\varphi$ is injective if an only if the map of sheaves $f^{\#}: \locO_X \to f_*\locO_Y$ is injective. Show furthermore in that case $f$ is dominant, i.e., $f(Y)$ is dense in $X$.

		\item With the same notation, show that if $\varphi$ is surjective, the $f$ is an homeomorphism of $Y$ onto a closed subset of $X$, and $f^{\#}: \locO_X \to f_*\locO_Y$ is surjective.

		\item Prove the converse of (c), namely, if $f: Y \to X$ is a homeomorphism onto a closed subset, and $f^{\#}: \locO_X \to f_*\locO_Y$ is surjective, then $\varphi$ is surjective.
	\end{enumerate}
\end{ex}

\begin{sol}
	\begin{enumerate}[label=\alph*)]
		\item $D(f) = \varnothing \imp \, \, \forall \ip \in A, f \in \ip, (f) \subseteq \ip$. That implies $(f) \subseteq \bigcap_{\ip \text{ prime }} \ip$, and so $f$ is nilpotent.

		Reciprocally, if $f$ is nilpotent, $f^n = 0 \in \ip$ for every prime ideal $\ip$, and therefore $f \in \ip, \, \, \forall \ip$, which means that $D(f) = \varnothing$.

		\item The map of sheaves $f^{\#}$ is injective if and only if the induced applications on stalks are injective. But we already know (from the proof of Proposition 2.3) that the induced applications on stalks are $\varphi_{\ip}: A_{\varphi^{-1}(\ip)} \to B_{\ip}$. Then, it is enough to show that $\varphi$ is injective if and anly if $\varphi_{\ip}$ is injective for every prime ideal $\ip$.

		$\boxed{\Leftarrow}$ Suppose that $\varphi(a) = 0$. Then, $\varphi_{\ip}(\frac{a}{1}) = \frac{\varphi(a)}{1} = 0$. That means $\frac{a}{1} = 0$ in $A_{\varphi^{-1}(\ip)}$ for every prime $\ip$, which means that $\exists s_i$ such that $s_i a = 0$, where $s_i \notin \ip_i$ and $i$ ranges over all prime ideals of $\ia$. Now note that $\bigcup_i D(s_i)$ covers all $\Spec(A)$: As $\Spec(A)$ is quasi-compact, we can extract a finite covering $s_1, \dots, s_n$ such that $\bigcup_{i = 1}^n D(s_i)$ covers $\Spec(A)$, which means that $(s_1, \dots, s_n) = (1)$ (indeed, $\varnothing = X\setminus \bigcup_{i = 1}^n D(s_i)) = \bigcap_{i = 1}^n (X\setminus D(f_i)) = \bigcap_{i = 1}^n V(s_i) = V((s_1, \dots, s_n))$). Therefore, $\exists a_i, i = 1, \dots, n$ such that $\sum_{i = 1}^n a_i s_i = 1$. Then, $a = (\sum_{i = 1}^n a_i s_i)a = 0$, as $s_i a = 0 \, \, \forall i$.

		$\boxed{\Rightarrow}$ First, let's prove that $\mathrm{Ann}(\varphi(a))^c = \mathrm{Ann}(a)$. If $t \in \mathrm{Ann}(a)$, then $\varphi(t)\varphi(a) = \varphi(ta) = \varphi(0) = 0$ so $\varphi(t) \in \mathrm{Ann}(\varphi(a)) \imp t \in \mathrm{Ann}(\varphi(a))^c$. Reciprocally, $t \in \mathrm{Ann}(\varphi(a))^c \imp \varphi(t)\varphi(a) = 0 \imp \varphi(ta) = 0$, and, as $\varphi$ is injective, this implies $ta = 0 \imp t \in \mathrm{Ann}(a)$.

		Similarly, let's prove now that $\mathrm{Ann}(\varphi(a)) = \mathrm{Ann}(a)^e$. Taking extensions of ideals on the equality we have just proved we have $\mathrm{Ann}(a)^e = \mathrm{Ann}(\varphi(a))^{ce} \subseteq \mathrm{Ann}(\varphi(a))$ (the last inclusion is true in general, Atiyah-Macdonald Proposition 1.17). Reciprocally, given $x \in \mathrm{Ann}(a)^e \imp x = \sum b_i \varphi(x_i)$, where $x_i \in \mathrm{Ann}(a)$. Then, $a\varphi(a) = \sum b_i \varphi(x_i a) = 0 \imp x \in \mathrm{Ann}(\varphi(a))$. These two equalities prove that $\mathrm{Ann}(a) = \mathrm{Ann}(a)^{ec}$.

		We want to prove that $\varphi_{\ip}$ is injective. Suppose that we have $\varphi_{\ip}(\frac{a}{s}) = 0$, which means that $\exists t \notin \ip$ such that $t\varphi(a) = 0$. Now suppose that $\frac{a}{s} \neq 0$, that is, that $\nexists s \in A, s \notin \ip^c$ such that $s \in \mathrm{Ann}(a)$, which is equivalent to $\ip^c \supseteq \mathrm{Ann}(a) = \mathrm{Ann}(a)^{ec}$. Taking extensions on both sides we have $\mathrm{Ann}(a)^{ece} = \mathrm{Ann}(a)^e = \mathrm{Ann}(\varphi(a)) \subseteq \ip^{ce} \subseteq \ip$. But this is a contradiction with the existence of $t$, which comes from assuming $\frac{a}{s} \neq 0$. Then $\frac{a}{s} = 0$ and so $\varphi_{\ip}$ is injective.

		Now let's check that $f(Y)$ is dense in $X$. As $\varphi$ is injective, the nilradical of $A$ is the contraction of the nilradical of $B$, because $\varphi(f)^n = 0 \imp \varphi(f^n) = 0 \imp f^n = 0$. Then, $X = V(r(0)) = V(r(0)^c) = V((\bigcap \ip)^c) = V(\bigcap(\ip^c))$. On the other side, $\overline{f(Y)} = \bigcap_{V(\ia) \supseteq f(Y)} V(\ia)$. Note that $V(\ia) \supseteq f(Y) \imp \ia \subseteq \ip^c \forall \ip$, so $\ia \subseteq \bigcap \ip^c \imp V(\ia) \supseteq V(\bigcap (\ip^c))$. Then, $V(\bigcap(\ip^c)) = \bigcap_{V(\ia) \supseteq f(Y)} V(\ia)$, which proves that $\overline{f(Y)} = X$.

		\item If $B = \varphi(A)$, then the application $A / \ker\varphi \cong B$, so we have a bijective correspondence between ideals of $A$ that contain $\ker \varphi$ and ideals of $B$. Therefore $f: \Spec(B) \to V(\ker \varphi)$ is bijective. Now we will check that the inverse, $f^{-1}: V(\ker \varphi) \to \Spec(B)$ is continuous. Given $f \in B, \, (f^{-1})^{-1}(D(f)) = D(g) \cap V(\ker \varphi)$ for any arbitrary $g \in \varphi^{-1}(f)$, because, given $\ip \supseteq \ker \varphi$, $\varphi^{-1}(f) \ni x \in \ip \iff \varphi^{-1}(f) \subseteq \ip$, and as $\varphi$ is surjective, $f \in \ip \iff \exists x \in \varphi^{-1}(f)$ such that $x \in \varphi^{-1}(\ip)$. This proves that $f^{-1}$ is continuous so we have an homeomorphism from $Y$ to $V(\ker \varphi)$, which is a closed subset of $X$.

		Moreover, the sheaf morphism $f^{\#}: \locO_X \to f_* \locO_Y$ is surjective, because the induced applications on stalks are $\varphi_{\ip}: A_{\varphi^{-1}(\ip)} \to B_{\ip}$, which are surjective because given $\frac{b}{t} \in B_{\ip}$, we can take $a, s \in A$ such that $s \notin \varphi^{-1}(\ip)$ such that $t = \varphi(s)$, $b = \varphi(t)$ because $\varphi$ is surjective. Then, $\varphi_{\ip}(\frac{a}{s}) = \frac{b}{t}$ and so $\varphi_{\ip}$ is surjective.

		\item Given $\varphi: A \to B$, it can be decomposed into the composition $\varphi = \varphi' \circ \pi: A \to A/\ker \varphi \to B$, where $\varphi'$ is injective and $\pi$ is surjective. Then, it is enough to check that $\varphi'$ is surjective. In turn, the application $f: \Spec(B) \to \Spec(A)$ is the composition $f = h \circ g: \Spec(B) \to \Spec(A/\ker \varphi) \to \Spec(A)$. As $\pi$ is surjective, $h: \Spec(A/\ker \varphi) \to \Spec(A)$ is an homeomorphism of $\Spec(A/\ker \varphi)$ into the closed set of $X$ $V(\ker \varphi)$ (we are using here (c)).

		Moreover, as $f$ is an homeomorphism onto a closed subset of $X$, $f(\Spec(B)) = \overline{f(\Spec(B))} = \overline{h(g(\Spec(B)))}$ and as $h$ is an homeomorphism, the closure of the image is the image of the closure, so $f(\Spec(B)) = h(\overline{g(\Spec(B))})$. As $\varphi$ is injective, using (b) the image of $g$ is dense in $\Spec(A/\ker \varphi)$, so $f(\Spec(B)) = V(\ker \varphi)$. Then, we have that $g$ is an homeomorphism of $\Spec(B)$ onto $\Spec(A/\ker \varphi) =: X'$. As $\varphi'$ is injective, then the morphism of sheaves $g^{\#}: \locO_{X'} \to g_* \locO_{Y}$ is injective by $(b)$. Moreover, it is also surjective because $f^{\#}: \locO_X \to h_*\locO_{X'} \to g_* h_* \locO_Y$ is surjective and $h$ is an homeomorphism.

		Then, we can reduce to the case $f: Y \to X$ is an homeomorphism, $f^{\#}: \locO_X \to f_* \locO_Y$ is an isomorphism of sheaves. Now given $b \in B = \Gamma(\locO_Y, Y)$, $\exists$ an open covering of $Y$, $\{U_i\}$, and $\exists ! s_i \in \Gamma(\locO_X, f^{-1}(U_i))$ such that $f^{\#}(f^{-1}(U_i))(s_i) = b|_{U_i}$ (we are using here the surjectivity of $f^{\#}$ and the fact that $f$ is an homeomorphism). Then, $f^{\#}(f^{-1}(U_i) \cap f^{-1}(U_j))(s_i|_{f^{-1}(U_i) \cap f^{-1}(U_j)}) = b|_{U_i \cap U_j} = f^{\#}(f^{-1}(U_i) \cap f^{-1}(U_j))(s_j|_{f^{-1}(U_i) \cap f^{-1}(U_j)})$. Then, by injectivity of $f^{\#}$, we have that $s_i|_{f^{-1}(U_i) \cap f^{-1}(U_j)} = s_j|_{f^{-1}(U_i) \cap f^{-1}(U_j)}$, so by properties of sheaves we have $\exists s \in \Gamma(\locO_X, X)$ such that $s_{f^{-1}(U_i)} = s_i$. Then $f^{\#}(X)(s)|_{U_i} = f^{\#}(f^{-1}(U_i))(s_i) = b|_{U_i}$, so $f^{\#}(X)(s) = b$, which proves that $\varphi$ is surjective.
		\end{enumerate}
\end{sol}

\begin{ex}
	Let A be a ring. Show that the following conditions are equivalent:
	\begin{enumerate}[label=\roman*)]
		\item $\Spec(A)$ is disconnected;
		\item there exist nonzero elements $e_1, e_2 \in A$ such that $e_1e_2 = 0$, $e_1^2 = e_1$, $e_2^2 = e_2$, $e_1 + e_2 = 1$ (these elements are called orthogonal idempotents);
		\item $A$ is isomorphic to a direct product $A_1 \times A_2$ of two nonzero rings.
	\end{enumerate}
\end{ex}

\begin{sol}
	$\boxed{(iii) \imp (ii)}$ Let $\phi: A_1 \times A_2 \to A$ be an isomorphism. Then consider $e_1: = \phi((1,0))$ and $e_2 := \phi((0,1))$. Then $e_1^2 = \phi((1,0))^2 = \phi((1,0)^2) = \phi((1,0)) = e_1$ and analogoulsy with $e_2$, so $e_i^2 = e_i$. $e_1 e_2 = \phi((1,0))\phi((0,1)) = \phi((1,0)(0,1)) = \phi(0) = 0$ and $e_1 + e_2 = \phi((1,0)) + \phi((0,1)) = \phi((1,0)+ (0,1)) = \phi(1) = 1$.

	$\boxed{(ii) \imp (i)}$ $V(e_i)$ are closed sets. The ideal generated by $e_1, e_2$ is the whole ring, so $\varnothing = V((e_1,e_2)) = V(e_1 \cup e_2) = V(e_1) \cap V(e_2)$. Moreover $(e_1)(e_2) = (e_1e_2) = 0$, so $V(e_1) \cup V(e_2) = V((e_1)(e_2)) = V(0) = \Spec(A)$, and therefore $\Spec(A)$ is disconnected.

	$\boxed{(i) \imp (iii)}$ First let's observe that it is enough to find two ideals $\ia_1, \ia_2$ such that $A$ is the direct sum of these ideals, i.e. $\ia_1 + \ia_2 = A, \, \ia_1 \cap \ia_2 = 0$ because $A_1 \times A_2 = A_1 \oplus A_2$ and the application $\psi: A \to A/\ia_1 \times A/\ia_2$, $x \mapsto (x_1, x_2)$, where $x_i$ is the class of $x$ in $A/\ia_i$ is bijective. Indeed, $\psi(a) = (0,0) \imp a \in \ia_1 \cap \ia_2 = 0$, so $\psi$ is injective. In addiction each $y_1 \in A/\ia_1$ has a representant $x_1 \in \ia_2$, and each $y_2 \in A/\ia_2$ has a representant $x_2 \in \ia_1$, so $\psi(x_1+x_2) = (y_1, y_2)$ and $\psi$ is bijective.

	So now let's proceed to find these ideals. As $\Spec(A)$ is disconnected, $\exists \ia_1, \ia_2 \neq A$ such that $\Spec(A) = V(\ia_1) \cup V(\ia_2)$, which implies that $\ia_1 \ia_2$ is included in the nilradical of $A$; It also happens that $V(\ia_1) \cap V(\ia_2) = \varnothing$, which implies that $\ia_1 + \ia_2 = (1)$. These ideals are still not what we are looking for because their intersection is not necessarily $0$. But as the sum of the two ideals is the whole ring, $\exists a_i \in \ia_i$ such that $a_1 + a_2 = 1$. $a_1a_2 \in \ia_1 \ia_2$ and therefore it is a nilpotent element. Let $n$ such that $(a_1a_2)^n = 0$. Then $1 = 1^n = (a_1+a_2)^n = a_1^n + a_2^n + b$, where $b$ is a nilpotent element, because it is the sum of elements $a_1^k a_2^m$, with $m, k \geq 1$, which belong to $\ia_1 \ia_2$, and therefore are nilpotents. Now $a_1^n + a_2^n = 1-b$, and therefore it's a unit, as it is the sum of a unit and a nilpotent element (we are using here Exercise 1.1 of Atiyah-MacDonald). In consequence, we have $(a_1^n) + (a_2^n) = (1)$ and the intersection of these two ideals is equal to their product, as they're coprime (Proposition 1.10 of Atiyah-MacdDonald). So we have that $(a_1^n) \cap (a_2^n) = (a_1^n)(a_2^n) = ((a_1a_2)^n) = 0$. Therefore $A = (a_1^n) \oplus (a_2^n)$ and so $A \cong A/(a_1^n) \times A/(a_2^n)$. These rings are both nonzero because $\ia_i \neq A$ (as the close sets $V(\ia_i)$ are not the whole ring, otherwise they wouldn't be a disconnection of $\Spec(A)$.

\end{sol}